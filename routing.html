<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.21.2">
    <meta name="project" content="Phoenix v1.4.15">
    <title>Routing â€” Phoenix v1.4.15</title>
    <link rel="stylesheet" href="dist/html-de2388dc2f8074b0a4db.css" />
    <script src="dist/sidebar_items-c08200cd71.js"></script>
      <script src="docs_config.js"></script>
    <script async src="dist/html-de2388dc2f8074b0a4db.js"></script>
  </head>
  <body data-type="extras">
    <script>try { if(localStorage.getItem('night-mode') === 'true') document.body.className += ' night-mode'; } catch (e) { }</script>
<div class="main">

<button class="sidebar-button sidebar-toggle">
  <span class="icon-menu" title="Collapse/expand sidebar"></span>
</button>

<section class="sidebar">
  <form class="sidebar-search" action="search.html">
    <button type="submit" class="search-button">
      <span class="icon-search" aria-hidden="true"></span>
    </button>
    <button type="button" tabindex="-1" class="search-close-button">
      <span class="icon-cross" title="Cancel search"></span>
    </button>
    <label class="search-label">
      <input name="q" type="text" id="search-list" class="search-input" placeholder="Search..." aria-label="Search" autocomplete="off" />
    </label>
  </form>

  <div class="autocomplete">
    <div class="autocomplete-results">
    </div>
  </div>

  <div class="sidebar-header">
    <div class="sidebar-projectDetails">
      <a href="http://www.phoenixframework.org" class="sidebar-projectName">
Phoenix      </a>
      <h2 class="sidebar-projectVersion">
        v1.4.15
      </h2>
    </div>
      <a href="http://www.phoenixframework.org">
        <img src="assets/logo.png" alt="Phoenix" class="sidebar-projectImage">
      </a>
  </div>

  <ul class="sidebar-listNav">
    <li><a id="extras-list" href="#full-list">GUIDES</a></li>

      <li><a id="modules-list" href="#full-list">Modules</a></li>

      <li><a id="exceptions-list" href="#full-list">Exceptions</a></li>

      <li><a id="tasks-list" href="#full-list">Mix Tasks</a></li>
  </ul>
  <div class="gradient"></div>
  <ul id="full-list" class="sidebar-fullList"></ul>
</section>

<section class="content">
  <div class="content-outer">
    <div id="content" class="content-inner">

<h1>Routing</h1>
<p>Routers are the main hubs of Phoenix applications. They match HTTP requests to controller actions, wire up real-time channel handlers, and define a series of pipeline transformations for scoping middleware to sets of routes.</p>
<p>The router file that Phoenix generates, <code class="inline">lib/hello_web/router.ex</code>, will look something like this one:</p>
<pre><code class="nohighlight makeup elixir"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">HelloWeb.Router</span><span class="w"> </span><span class="k" data-group-id="0827950712-1">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">HelloWeb</span><span class="p">,</span><span class="w"> </span><span class="ss">:router</span><span class="w">

  </span><span class="n">pipeline</span><span class="w"> </span><span class="ss">:browser</span><span class="w"> </span><span class="k" data-group-id="0827950712-2">do</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:accepts</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0827950712-3">[</span><span class="s">&quot;html&quot;</span><span class="p" data-group-id="0827950712-3">]</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:fetch_session</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:fetch_flash</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:protect_from_forgery</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:put_secure_browser_headers</span><span class="w">
  </span><span class="k" data-group-id="0827950712-2">end</span><span class="w">

  </span><span class="n">pipeline</span><span class="w"> </span><span class="ss">:api</span><span class="w"> </span><span class="k" data-group-id="0827950712-4">do</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:accepts</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0827950712-5">[</span><span class="s">&quot;json&quot;</span><span class="p" data-group-id="0827950712-5">]</span><span class="w">
  </span><span class="k" data-group-id="0827950712-4">end</span><span class="w">

  </span><span class="n">scope</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">HelloWeb</span><span class="w"> </span><span class="k" data-group-id="0827950712-6">do</span><span class="w">
    </span><span class="n">pipe_through</span><span class="w"> </span><span class="ss">:browser</span><span class="w">

    </span><span class="n">get</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">PageController</span><span class="p">,</span><span class="w"> </span><span class="ss">:index</span><span class="w">
  </span><span class="k" data-group-id="0827950712-6">end</span><span class="w">

  </span><span class="c1"># Other scopes may use custom stacks.</span><span class="w">
  </span><span class="c1"># scope &quot;/api&quot;, HelloWeb do</span><span class="w">
  </span><span class="c1">#   pipe_through :api</span><span class="w">
  </span><span class="c1"># end</span><span class="w">
</span><span class="k" data-group-id="0827950712-1">end</span></code></pre>
<p>Both the router and controller module names will be prefixed with the name you gave your application instead of <code class="inline">HelloWeb</code>.</p>
<p>The first line of this module, <code class="inline">use HelloWeb, :router</code>, simply makes Phoenix router functions available in our particular router.</p>
<p>Scopes have their own section in this guide, so we won&#39;t spend time on the <code class="inline">scope &quot;/&quot;, HelloWeb do</code> block here. The <code class="inline">pipe_through :browser</code> line will get a full treatment in the Pipeline section of this guide. For now, you only need to know that pipelines allow a set of middleware transformations to be applied to different sets of routes.</p>
<p>Inside the scope block, however, we have our first actual route:</p>
<pre><code class="nohighlight makeup elixir"><span class="n">get</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">PageController</span><span class="p">,</span><span class="w"> </span><span class="ss">:index</span></code></pre>
<p><code class="inline">get</code> is a Phoenix macro which expands out to define one clause of the <code class="inline">match/5</code> function. It corresponds to the HTTP verb GET. Similar macros exist for other HTTP verbs including POST, PUT, PATCH, DELETE, OPTIONS, CONNECT, TRACE and HEAD.</p>
<p>The first argument to these macros is the path. Here, it is the root of the application, <code class="inline">/</code>. The next two arguments are the controller and action we want to have handle this request. These macros may also take other options, which we will see throughout the rest of this guide.</p>
<p>If this were the only route in our router module, the clause of the <code class="inline">match/5</code> function would look like this after the macro is expanded:</p>
<pre><code class="nohighlight makeup elixir"><span class="kd">def</span><span class="w"> </span><span class="nf">match</span><span class="p" data-group-id="3354203999-1">(</span><span class="ss">:get</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">PageController</span><span class="p">,</span><span class="w"> </span><span class="ss">:index</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3354203999-2">[</span><span class="p" data-group-id="3354203999-2">]</span><span class="p" data-group-id="3354203999-1">)</span></code></pre>
<p>The body of the <code class="inline">match/5</code> function sets up the connection and invokes the matched controller action.</p>
<p>As we add more routes, more clauses of the match function will be added to our router module. These will behave like any other multi-clause function in Elixir. They will be tried in order from the top, and the first clause to match the parameters given (verb and path) will be executed. After a match is found, the search will stop and no other clauses will be tried.</p>
<p>This means that it is possible to create a route which will never match, based on the HTTP verb and the path, regardless of the controller and action.</p>
<p>If we do create an ambiguous route, the router will still compile, but we will get a warning. Let&#39;s see this in action.</p>
<p>Define this route at the bottom of the <code class="inline">scope &quot;/&quot;, HelloWeb do</code> block in the router.</p>
<pre><code class="nohighlight makeup elixir"><span class="n">get</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">RootController</span><span class="p">,</span><span class="w"> </span><span class="ss">:index</span></code></pre>
<p>Then run <a href="https://hexdocs.pm/mix/Mix.Tasks.Compile.html"><code class="inline">mix compile</code></a> at the root of your project.</p>
<h2 id="examining-routes" class="section-heading">
  <a href="#examining-routes" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examining Routes
</h2>

<p>Phoenix provides a great tool for investigating routes in an application, the mix task <code class="inline">phx.routes</code>.</p>
<p>Let&#39;s see how this works. Go to the root of a newly-generated Phoenix application and run <a href="Mix.Tasks.Phx.Routes.html"><code class="inline">mix phx.routes</code></a>. (If you haven&#39;t already done so, you&#39;ll need to run <code class="inline">mix do deps.get, compile</code> before running the <code class="inline">routes</code> task.) You should see something like the following, generated from the only route we currently have:</p>
<pre><code class="console">$ mix phx.routes
page_path  GET  /  HelloWeb.PageController :index</code></pre>
<p>The output tells us that any HTTP GET request for the root of the application will be handled by the <code class="inline">index</code> action of the <code class="inline">HelloWeb.PageController</code>.</p>
<p><code class="inline">page_path</code> is an example of what Phoenix calls a path helper, and we&#39;ll talk about those very soon.</p>
<h2 id="resources" class="section-heading">
  <a href="#resources" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Resources
</h2>

<p>The router supports other macros besides those for HTTP verbs like <code class="inline">get</code>, <code class="inline">post</code>, and <code class="inline">put</code>. The most important among them is <code class="inline">resources</code>, which expands out to eight clauses of the <code class="inline">match/5</code> function.</p>
<p>Let&#39;s add a resource to our <code class="inline">lib/hello_web/router.ex</code> file like this:</p>
<pre><code class="nohighlight makeup elixir"><span class="n">scope</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">HelloWeb</span><span class="w"> </span><span class="k" data-group-id="4199724754-1">do</span><span class="w">
  </span><span class="n">pipe_through</span><span class="w"> </span><span class="ss">:browser</span><span class="w">

  </span><span class="n">get</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">PageController</span><span class="p">,</span><span class="w"> </span><span class="ss">:index</span><span class="w">
  </span><span class="n">resources</span><span class="w"> </span><span class="s">&quot;/users&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">UserController</span><span class="w">
</span><span class="k" data-group-id="4199724754-1">end</span></code></pre>
<p>For this purpose, it doesn&#39;t matter that we don&#39;t actually have a <code class="inline">HelloWeb.UserController</code>.</p>
<p>Then go to the root of your project, and run <a href="Mix.Tasks.Phx.Routes.html"><code class="inline">mix phx.routes</code></a></p>
<p>You should see something like the following:</p>
<pre><code class="nohighlight makeup elixir"><span class="n">user_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">users</span><span class="w">           </span><span class="nc">HelloWeb.UserController</span><span class="w"> </span><span class="ss">:index</span><span class="w">
</span><span class="n">user_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:id</span><span class="o">/</span><span class="n">edit</span><span class="w">  </span><span class="nc">HelloWeb.UserController</span><span class="w"> </span><span class="ss">:edit</span><span class="w">
</span><span class="n">user_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">new</span><span class="w">       </span><span class="nc">HelloWeb.UserController</span><span class="w"> </span><span class="ss">:new</span><span class="w">
</span><span class="n">user_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.UserController</span><span class="w"> </span><span class="ss">:show</span><span class="w">
</span><span class="n">user_path</span><span class="w">  </span><span class="nc">POST</span><span class="w">    </span><span class="o">/</span><span class="n">users</span><span class="w">           </span><span class="nc">HelloWeb.UserController</span><span class="w"> </span><span class="ss">:create</span><span class="w">
</span><span class="n">user_path</span><span class="w">  </span><span class="nc">PATCH</span><span class="w">   </span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.UserController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
           </span><span class="nc">PUT</span><span class="w">     </span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.UserController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
</span><span class="n">user_path</span><span class="w">  </span><span class="nc">DELETE</span><span class="w">  </span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.UserController</span><span class="w"> </span><span class="ss">:delete</span></code></pre>
<p>Of course, the name of your project will replace <code class="inline">HelloWeb</code>.</p>
<p>This is the standard matrix of HTTP verbs, paths, and controller actions. Let&#39;s look at them individually, in a slightly different order.</p>
<ul>
<li>A GET request to <code class="inline">/users</code> will invoke the <code class="inline">index</code> action to show all the users.
</li>
<li>A GET request to <code class="inline">/users/:id</code> will invoke the <code class="inline">show</code> action with an id to show an individual user identified by that ID.
</li>
<li>A GET request to <code class="inline">/users/new</code> will invoke the <code class="inline">new</code> action to present a form for creating a new user.
</li>
<li>A POST request to <code class="inline">/users</code> will invoke the <code class="inline">create</code> action to save a new user to the data store.
</li>
<li>A GET request to <code class="inline">/users/:id/edit</code> will invoke the <code class="inline">edit</code> action with an ID to retrieve an individual user from the data store and present the information in a form for editing.
</li>
<li>A PATCH request to <code class="inline">/users/:id</code> will invoke the <code class="inline">update</code> action with an ID to save the updated user to the data store.
</li>
<li>A PUT request to <code class="inline">/users/:id</code> will also invoke the <code class="inline">update</code> action with an ID to save the updated user to the data store.
</li>
<li>A DELETE request to <code class="inline">/users/:id</code> will invoke the <code class="inline">delete</code> action with an ID to remove the individual user from the data store.
</li>
</ul>
<p>If we don&#39;t feel that we need all of these routes, we can be selective using the <code class="inline">:only</code> and <code class="inline">:except</code> options.</p>
<p>Let&#39;s say we have a read-only posts resource. We could define it like this:</p>
<pre><code class="nohighlight makeup elixir"><span class="n">resources</span><span class="w"> </span><span class="s">&quot;/posts&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">PostController</span><span class="p">,</span><span class="w"> </span><span class="ss">only</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="8048792440-1">[</span><span class="ss">:index</span><span class="p">,</span><span class="w"> </span><span class="ss">:show</span><span class="p" data-group-id="8048792440-1">]</span></code></pre>
<p>Running <a href="Mix.Tasks.Phx.Routes.html"><code class="inline">mix phx.routes</code></a> shows that we now only have the routes to the index and show actions defined.</p>
<pre><code class="nohighlight makeup elixir"><span class="n">post_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">posts</span><span class="w">      </span><span class="nc">HelloWeb.PostController</span><span class="w"> </span><span class="ss">:index</span><span class="w">
</span><span class="n">post_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">posts</span><span class="o">/</span><span class="ss">:id</span><span class="w">  </span><span class="nc">HelloWeb.PostController</span><span class="w"> </span><span class="ss">:show</span></code></pre>
<p>Similarly, if we have a comments resource, and we don&#39;t want to provide a route to delete one, we could define a route like this.</p>
<pre><code class="nohighlight makeup elixir"><span class="n">resources</span><span class="w"> </span><span class="s">&quot;/comments&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">CommentController</span><span class="p">,</span><span class="w"> </span><span class="ss">except</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="3169279407-1">[</span><span class="ss">:delete</span><span class="p" data-group-id="3169279407-1">]</span></code></pre>
<p>Running <a href="Mix.Tasks.Phx.Routes.html"><code class="inline">mix phx.routes</code></a> now shows that we have all the routes except the DELETE request to the delete action.</p>
<pre><code class="nohighlight makeup elixir"><span class="n">comment_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">    </span><span class="o">/</span><span class="n">comments</span><span class="w">           </span><span class="nc">HelloWeb.CommentController</span><span class="w"> </span><span class="ss">:index</span><span class="w">
</span><span class="n">comment_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">    </span><span class="o">/</span><span class="n">comments</span><span class="o">/</span><span class="ss">:id</span><span class="o">/</span><span class="n">edit</span><span class="w">  </span><span class="nc">HelloWeb.CommentController</span><span class="w"> </span><span class="ss">:edit</span><span class="w">
</span><span class="n">comment_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">    </span><span class="o">/</span><span class="n">comments</span><span class="o">/</span><span class="n">new</span><span class="w">       </span><span class="nc">HelloWeb.CommentController</span><span class="w"> </span><span class="ss">:new</span><span class="w">
</span><span class="n">comment_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">    </span><span class="o">/</span><span class="n">comments</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.CommentController</span><span class="w"> </span><span class="ss">:show</span><span class="w">
</span><span class="n">comment_path</span><span class="w">  </span><span class="nc">POST</span><span class="w">   </span><span class="o">/</span><span class="n">comments</span><span class="w">           </span><span class="nc">HelloWeb.CommentController</span><span class="w"> </span><span class="ss">:create</span><span class="w">
</span><span class="n">comment_path</span><span class="w">  </span><span class="nc">PATCH</span><span class="w">  </span><span class="o">/</span><span class="n">comments</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.CommentController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
              </span><span class="nc">PUT</span><span class="w">    </span><span class="o">/</span><span class="n">comments</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.CommentController</span><span class="w"> </span><span class="ss">:update</span></code></pre>
<p>The <a href="Phoenix.Router.html#resources/4"><code class="inline">Phoenix.Router.resources/4</code></a> macro describes additional options for customizing resource routes.</p>
<h2 id="forward" class="section-heading">
  <a href="#forward" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Forward
</h2>

<p>The <a href="Phoenix.Router.html#forward/4"><code class="inline">Phoenix.Router.forward/4</code></a> macro can be used to send all requests that start with a particular path to a particular plug. Let&#39;s say we have a part of our system that is responsible (it could even be a separate application or library) for running jobs in the background, it could have its own web interface for checking the status of the jobs. We can forward to this admin interface using:</p>
<pre><code class="nohighlight makeup elixir"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">HelloWeb.Router</span><span class="w"> </span><span class="k" data-group-id="2509881949-1">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">HelloWeb</span><span class="p">,</span><span class="w"> </span><span class="ss">:router</span><span class="w">

  </span><span class="n">...</span><span class="w">

  </span><span class="n">scope</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">HelloWeb</span><span class="w"> </span><span class="k" data-group-id="2509881949-2">do</span><span class="w">
    </span><span class="n">...</span><span class="w">
  </span><span class="k" data-group-id="2509881949-2">end</span><span class="w">

  </span><span class="n">forward</span><span class="w"> </span><span class="s">&quot;/jobs&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">BackgroundJob.Plug</span><span class="w">
</span><span class="k" data-group-id="2509881949-1">end</span></code></pre>
<p>This means that all routes starting with <code class="inline">/jobs</code> will be sent to the <code class="inline">HelloWeb.BackgroundJob.Plug</code> module.</p>
<p>We can even use the <code class="inline">forward/4</code> macro in a pipeline. If we wanted to ensure that the user was authenticated and an administrator in order to see the jobs page, we could use the following in our router.</p>
<pre><code class="nohighlight makeup elixir"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">HelloWeb.Router</span><span class="w"> </span><span class="k" data-group-id="3706092273-1">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">HelloWeb</span><span class="p">,</span><span class="w"> </span><span class="ss">:router</span><span class="w">

  </span><span class="n">...</span><span class="w">

  </span><span class="n">scope</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="w"> </span><span class="k" data-group-id="3706092273-2">do</span><span class="w">
    </span><span class="n">pipe_through</span><span class="w"> </span><span class="p" data-group-id="3706092273-3">[</span><span class="ss">:authenticate_user</span><span class="p">,</span><span class="w"> </span><span class="ss">:ensure_admin</span><span class="p" data-group-id="3706092273-3">]</span><span class="w">
    </span><span class="n">forward</span><span class="w"> </span><span class="s">&quot;/jobs&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">BackgroundJob.Plug</span><span class="w">
  </span><span class="k" data-group-id="3706092273-2">end</span><span class="w">
</span><span class="k" data-group-id="3706092273-1">end</span></code></pre>
<p>This means that the plugs in the <code class="inline">authenticate_user</code> and <code class="inline">ensure_admin</code> pipelines will be called before the <code class="inline">BackgroundJob.Plug</code> allowing them to send an appropriate response and call <code class="inline">halt()</code> .</p>
<p>The <code class="inline">opts</code> that are passed to the <code class="inline">init/1</code> callback of a Plug can be passed as a 3rd argument. For example, maybe the background job page lets you set the name of your application to be displayed on the page. This could be passed with:</p>
<pre><code class="nohighlight makeup elixir"><span class="n">forward</span><span class="w"> </span><span class="s">&quot;/jobs&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">BackgroundJob.Plug</span><span class="p">,</span><span class="w"> </span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Hello Phoenix&quot;</span></code></pre>
<p>There is a fourth <code class="inline">router_opts</code> argument that can be passed. These options are outlined in the <a href="Phoenix.Router.html#scope/2"><code class="inline">Phoenix.Router.scope/2</code></a> documentation.</p>
<p>Although it is possible to forward to any module plug, it is not advised to forward to another endpoint. This is because plugs defined by your app and the forwarded endpoint would be invoked twice, which may lead to errors.</p>
<p>Writing an actual background job worker is beyond the scope of this guide. However for convenience and to allow you to test the code above, here is the implementation of <code class="inline">BackgroundJob.Plug</code> that you can copy into your application inside <code class="inline">lib/plugs/background_job_plug.ex</code>:</p>
<pre><code class="nohighlight makeup elixir"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">HelloWeb.BackgroundJob.Plug</span><span class="w"> </span><span class="k" data-group-id="0080785673-1">do</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">init</span><span class="p" data-group-id="0080785673-2">(</span><span class="n">opts</span><span class="p" data-group-id="0080785673-2">)</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="n">opts</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">call</span><span class="p" data-group-id="0080785673-3">(</span><span class="n">conn</span><span class="p">,</span><span class="w"> </span><span class="n">opts</span><span class="p" data-group-id="0080785673-3">)</span><span class="w"> </span><span class="k" data-group-id="0080785673-4">do</span><span class="w">
    </span><span class="n">conn</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Plug.Conn</span><span class="o">.</span><span class="n">assign</span><span class="p" data-group-id="0080785673-5">(</span><span class="ss">:name</span><span class="p">,</span><span class="w"> </span><span class="nc">Keyword</span><span class="o">.</span><span class="n">get</span><span class="p" data-group-id="0080785673-6">(</span><span class="n">opts</span><span class="p">,</span><span class="w"> </span><span class="ss">:name</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Background Job&quot;</span><span class="p" data-group-id="0080785673-6">)</span><span class="p" data-group-id="0080785673-5">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">HelloWeb.BackgroundJob.Router</span><span class="o">.</span><span class="n">call</span><span class="p" data-group-id="0080785673-7">(</span><span class="n">opts</span><span class="p" data-group-id="0080785673-7">)</span><span class="w">
  </span><span class="k" data-group-id="0080785673-4">end</span><span class="w">
</span><span class="k" data-group-id="0080785673-1">end</span><span class="w">

</span><span class="kd">defmodule</span><span class="w"> </span><span class="nc">HelloWeb.BackgroundJob.Router</span><span class="w"> </span><span class="k" data-group-id="0080785673-8">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">Plug.Router</span><span class="w">

  </span><span class="n">plug</span><span class="w"> </span><span class="ss">:match</span><span class="w">
  </span><span class="n">plug</span><span class="w"> </span><span class="ss">:dispatch</span><span class="w">

  </span><span class="n">get</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="n">send_resp</span><span class="p" data-group-id="0080785673-9">(</span><span class="n">conn</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Welcome to </span><span class="si" data-group-id="0080785673-10">#{</span><span class="n">conn</span><span class="o">.</span><span class="n">assigns</span><span class="o">.</span><span class="n">name</span><span class="si" data-group-id="0080785673-10">}</span><span class="s">&quot;</span><span class="p" data-group-id="0080785673-9">)</span><span class="w">
  </span><span class="n">get</span><span class="w"> </span><span class="s">&quot;/active&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="n">send_resp</span><span class="p" data-group-id="0080785673-11">(</span><span class="n">conn</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;5 Active Jobs&quot;</span><span class="p" data-group-id="0080785673-11">)</span><span class="w">
  </span><span class="n">get</span><span class="w"> </span><span class="s">&quot;/pending&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="n">send_resp</span><span class="p" data-group-id="0080785673-12">(</span><span class="n">conn</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;3 Pending Jobs&quot;</span><span class="p" data-group-id="0080785673-12">)</span><span class="w">
  </span><span class="n">match</span><span class="w"> </span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="n">send_resp</span><span class="p" data-group-id="0080785673-13">(</span><span class="n">conn</span><span class="p">,</span><span class="w"> </span><span class="mi">404</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Not found&quot;</span><span class="p" data-group-id="0080785673-13">)</span><span class="w">
</span><span class="k" data-group-id="0080785673-8">end</span></code></pre>
<h2 id="path-helpers" class="section-heading">
  <a href="#path-helpers" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Path Helpers
</h2>

<p>Path helpers are functions which are dynamically defined on the <code class="inline">Router.Helpers</code> module for an individual application. For us, that is <code class="inline">HelloWeb.Router.Helpers</code>. Their names are derived from the name of the controller used in the route definition. Our controller is <code class="inline">HelloWeb.PageController</code>, and <code class="inline">page_path</code> is the function which will return the path to the root of our application.</p>
<p>That&#39;s a mouthful. Let&#39;s see it in action. Run <code class="inline">iex -S mix</code> at the root of the project. When we call the <code class="inline">page_path</code> function on our router helpers with the <code class="inline">Endpoint</code> or connection and action as arguments, it returns the path to us.</p>
<pre><code class="nohighlight makeup elixir"><span class="gp unselectable">iex&gt; </span><span class="nc">HelloWeb.Router.Helpers</span><span class="o">.</span><span class="n">page_path</span><span class="p" data-group-id="9945976169-1">(</span><span class="nc">HelloWeb.Endpoint</span><span class="p">,</span><span class="w"> </span><span class="ss">:index</span><span class="p" data-group-id="9945976169-1">)</span><span class="w">
</span><span class="s">&quot;/&quot;</span></code></pre>
<p>This is significant because we can use the <code class="inline">page_path</code> function in a template to link to the root of our application. We can then use this helper in our templates:</p>
<pre><code class="html">&lt;a href=&quot;&lt;%= Routes.page_path(@conn, :index) %&gt;&quot;&gt;To the Welcome Page!&lt;/a&gt;</code></pre>
<p>The reason we can use <code class="inline">Routes.page_path</code> instead of the full <code class="inline">HelloWeb.Router.Helpers.page_path</code> name is because <code class="inline">HelloWeb.Router.Helpers</code> is aliased as <code class="inline">Routes</code> by default in the <code class="inline">view/0</code> definition (<code class="inline">lib/hello_web.ex</code>) and made available to our templates through <code class="inline">use HelloWeb, :view</code>. We can, of course, use <code class="inline">HelloWeb.Router.Helpers.page_path(@conn, :index)</code> instead, but the convention is to use the aliased version for conciseness (note that the alias is only set automatically for use in views, controllers and templates - outside these you need either the full name, or to alias it yourself inside the module definition: <code class="inline">alias HelloWeb.Router.Helpers, as: Routes</code>). Please see the <a href="views.html">View Guide</a> for more information.</p>
<p>This pays off tremendously if we should ever have to change the path of our route in the router. Since the path helpers are built dynamically from the routes, any calls to <code class="inline">page_path</code> in our templates will still work.</p>
<h3 id="more-on-path-helpers" class="section-heading">
  <a href="#more-on-path-helpers" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  More on Path Helpers
</h3>

<p>When we ran the <code class="inline">phx.routes</code> task for our user resource, it listed the <code class="inline">user_path</code> as the path helper function for each line of output. Here is what that translates to for each action:</p>
<pre><code class="nohighlight makeup elixir"><span class="gp unselectable">iex&gt; </span><span class="kn">alias</span><span class="w"> </span><span class="nc">HelloWeb.Router.Helpers</span><span class="p">,</span><span class="w"> </span><span class="ss">as</span><span class="p">:</span><span class="w"> </span><span class="nc">Routes</span><span class="w">
</span><span class="gp unselectable">iex&gt; </span><span class="kn">alias</span><span class="w"> </span><span class="nc">HelloWeb.Endpoint</span><span class="w">
</span><span class="gp unselectable">iex&gt; </span><span class="nc">Routes</span><span class="o">.</span><span class="n">user_path</span><span class="p" data-group-id="2140886959-1">(</span><span class="nc">Endpoint</span><span class="p">,</span><span class="w"> </span><span class="ss">:index</span><span class="p" data-group-id="2140886959-1">)</span><span class="w">
</span><span class="s">&quot;/users&quot;</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="nc">Routes</span><span class="o">.</span><span class="n">user_path</span><span class="p" data-group-id="2140886959-2">(</span><span class="nc">Endpoint</span><span class="p">,</span><span class="w"> </span><span class="ss">:show</span><span class="p">,</span><span class="w"> </span><span class="mi">17</span><span class="p" data-group-id="2140886959-2">)</span><span class="w">
</span><span class="s">&quot;/users/17&quot;</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="nc">Routes</span><span class="o">.</span><span class="n">user_path</span><span class="p" data-group-id="2140886959-3">(</span><span class="nc">Endpoint</span><span class="p">,</span><span class="w"> </span><span class="ss">:new</span><span class="p" data-group-id="2140886959-3">)</span><span class="w">
</span><span class="s">&quot;/users/new&quot;</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="nc">Routes</span><span class="o">.</span><span class="n">user_path</span><span class="p" data-group-id="2140886959-4">(</span><span class="nc">Endpoint</span><span class="p">,</span><span class="w"> </span><span class="ss">:create</span><span class="p" data-group-id="2140886959-4">)</span><span class="w">
</span><span class="s">&quot;/users&quot;</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="nc">Routes</span><span class="o">.</span><span class="n">user_path</span><span class="p" data-group-id="2140886959-5">(</span><span class="nc">Endpoint</span><span class="p">,</span><span class="w"> </span><span class="ss">:edit</span><span class="p">,</span><span class="w"> </span><span class="mi">37</span><span class="p" data-group-id="2140886959-5">)</span><span class="w">
</span><span class="s">&quot;/users/37/edit&quot;</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="nc">Routes</span><span class="o">.</span><span class="n">user_path</span><span class="p" data-group-id="2140886959-6">(</span><span class="nc">Endpoint</span><span class="p">,</span><span class="w"> </span><span class="ss">:update</span><span class="p">,</span><span class="w"> </span><span class="mi">37</span><span class="p" data-group-id="2140886959-6">)</span><span class="w">
</span><span class="s">&quot;/users/37&quot;</span><span class="w">

</span><span class="gp unselectable">iex&gt; </span><span class="nc">Routes</span><span class="o">.</span><span class="n">user_path</span><span class="p" data-group-id="2140886959-7">(</span><span class="nc">Endpoint</span><span class="p">,</span><span class="w"> </span><span class="ss">:delete</span><span class="p">,</span><span class="w"> </span><span class="mi">17</span><span class="p" data-group-id="2140886959-7">)</span><span class="w">
</span><span class="s">&quot;/users/17&quot;</span></code></pre>
<p>What about paths with query strings? By adding an optional fourth argument of key value pairs, the path helpers will return those pairs in the query string.</p>
<pre><code class="nohighlight makeup elixir"><span class="gp unselectable">iex&gt; </span><span class="nc">Routes</span><span class="o">.</span><span class="n">user_path</span><span class="p" data-group-id="2850566306-1">(</span><span class="nc">Endpoint</span><span class="p">,</span><span class="w"> </span><span class="ss">:show</span><span class="p">,</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="ss">admin</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="2850566306-1">)</span><span class="w">
</span><span class="s">&quot;/users/17?admin=true&amp;active=false&quot;</span></code></pre>
<p>What if we need a full url instead of a path? Just replace <code class="inline">_path</code> with <code class="inline">_url</code>:</p>
<pre><code class="nohighlight makeup elixir"><span class="gp unselectable">iex(3)&gt; </span><span class="nc">Routes</span><span class="o">.</span><span class="n">user_url</span><span class="p" data-group-id="6681859612-1">(</span><span class="nc">Endpoint</span><span class="p">,</span><span class="w"> </span><span class="ss">:index</span><span class="p" data-group-id="6681859612-1">)</span><span class="w">
</span><span class="s">&quot;http://localhost:4000/users&quot;</span></code></pre>
<p>The <code class="inline">_url</code> functions will get the host, port, proxy port, and SSL information needed to construct the full URL from the configuration parameters set for each environment. We&#39;ll talk about configuration in more detail in its own guide. For now, you can take a look at <code class="inline">config/dev.exs</code> file in your own project to see those values.</p>
<p>Whenever possible prefer to pass a <code class="inline">conn</code> in place of an <code class="inline">Endpoint</code>.</p>
<h2 id="nested-resources" class="section-heading">
  <a href="#nested-resources" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Nested Resources
</h2>

<p>It is also possible to nest resources in a Phoenix router. Let&#39;s say we also have a <code class="inline">posts</code> resource which has a many-to-one relationship with <code class="inline">users</code>. That is to say, a user can create many posts, and an individual post belongs to only one user. We can represent that by adding a nested route in <code class="inline">lib/hello_web/router.ex</code> like this:</p>
<pre><code class="nohighlight makeup elixir"><span class="n">resources</span><span class="w"> </span><span class="s">&quot;/users&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">UserController</span><span class="w"> </span><span class="k" data-group-id="0015697991-1">do</span><span class="w">
  </span><span class="n">resources</span><span class="w"> </span><span class="s">&quot;/posts&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">PostController</span><span class="w">
</span><span class="k" data-group-id="0015697991-1">end</span></code></pre>
<p>When we run <a href="Mix.Tasks.Phx.Routes.html"><code class="inline">mix phx.routes</code></a> now, in addition to the routes we saw for <code class="inline">users</code> above, we get the following set of routes:</p>
<pre><code class="nohighlight makeup elixir"><span class="n">...</span><span class="w">
</span><span class="n">user_post_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:user_id</span><span class="o">/</span><span class="n">posts</span><span class="w">           </span><span class="nc">HelloWeb.PostController</span><span class="w"> </span><span class="ss">:index</span><span class="w">
</span><span class="n">user_post_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:user_id</span><span class="o">/</span><span class="n">posts</span><span class="o">/</span><span class="ss">:id</span><span class="o">/</span><span class="n">edit</span><span class="w">  </span><span class="nc">HelloWeb.PostController</span><span class="w"> </span><span class="ss">:edit</span><span class="w">
</span><span class="n">user_post_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:user_id</span><span class="o">/</span><span class="n">posts</span><span class="o">/</span><span class="n">new</span><span class="w">       </span><span class="nc">HelloWeb.PostController</span><span class="w"> </span><span class="ss">:new</span><span class="w">
</span><span class="n">user_post_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:user_id</span><span class="o">/</span><span class="n">posts</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.PostController</span><span class="w"> </span><span class="ss">:show</span><span class="w">
</span><span class="n">user_post_path</span><span class="w">  </span><span class="nc">POST</span><span class="w">    </span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:user_id</span><span class="o">/</span><span class="n">posts</span><span class="w">           </span><span class="nc">HelloWeb.PostController</span><span class="w"> </span><span class="ss">:create</span><span class="w">
</span><span class="n">user_post_path</span><span class="w">  </span><span class="nc">PATCH</span><span class="w">   </span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:user_id</span><span class="o">/</span><span class="n">posts</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.PostController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
                </span><span class="nc">PUT</span><span class="w">     </span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:user_id</span><span class="o">/</span><span class="n">posts</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.PostController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
</span><span class="n">user_post_path</span><span class="w">  </span><span class="nc">DELETE</span><span class="w">  </span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:user_id</span><span class="o">/</span><span class="n">posts</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.PostController</span><span class="w"> </span><span class="ss">:delete</span></code></pre>
<p>We see that each of these routes scopes the posts to a user ID. For the first one, we will invoke the <code class="inline">PostController</code> <code class="inline">index</code> action, but we will pass in a <code class="inline">user_id</code>. This implies that we would display all the posts for that individual user only. The same scoping applies for all these routes.</p>
<p>When calling path helper functions for nested routes, we will need to pass the IDs in the order they came in the route definition. For the following <code class="inline">show</code> route, <code class="inline">42</code> is the <code class="inline">user_id</code>, and <code class="inline">17</code> is the <code class="inline">post_id</code>. Let&#39;s remember to alias our <code class="inline">HelloWeb.Endpoint</code> before we begin.</p>
<pre><code class="nohighlight makeup elixir"><span class="gp unselectable">iex&gt; </span><span class="kn">alias</span><span class="w"> </span><span class="nc">HelloWeb.Endpoint</span><span class="w">
</span><span class="gp unselectable">iex&gt; </span><span class="nc">HelloWeb.Router.Helpers</span><span class="o">.</span><span class="n">user_post_path</span><span class="p" data-group-id="1414033250-1">(</span><span class="nc">Endpoint</span><span class="p">,</span><span class="w"> </span><span class="ss">:show</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="mi">17</span><span class="p" data-group-id="1414033250-1">)</span><span class="w">
</span><span class="s">&quot;/users/42/posts/17&quot;</span></code></pre>
<p>Again, if we add a key/value pair to the end of the function call, it is added to the query string.</p>
<pre><code class="nohighlight makeup elixir"><span class="gp unselectable">iex&gt; </span><span class="nc">HelloWeb.Router.Helpers</span><span class="o">.</span><span class="n">user_post_path</span><span class="p" data-group-id="9960046413-1">(</span><span class="nc">Endpoint</span><span class="p">,</span><span class="w"> </span><span class="ss">:index</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="9960046413-1">)</span><span class="w">
</span><span class="s">&quot;/users/42/posts?active=true&quot;</span></code></pre>
<p>If we had aliased the <code class="inline">Helpers</code> module as before (it is only automatically aliased for views, templates and controllers, in this case, since we&#39;re inside <code class="inline">iex</code> we need to do it ourselves), we could instead do:</p>
<pre><code class="nohighlight makeup elixir"><span class="gp unselectable">iex&gt; </span><span class="kn">alias</span><span class="w"> </span><span class="nc">HelloWeb.Router.Helpers</span><span class="p">,</span><span class="w"> </span><span class="ss">as</span><span class="p">:</span><span class="w"> </span><span class="nc">Routes</span><span class="w">
</span><span class="gp unselectable">iex&gt; </span><span class="kn">alias</span><span class="w"> </span><span class="nc">HelloWeb.Endpoint</span><span class="w">
</span><span class="gp unselectable">iex&gt; </span><span class="nc">Routes</span><span class="o">.</span><span class="n">user_post_path</span><span class="p" data-group-id="2824999653-1">(</span><span class="nc">Endpoint</span><span class="p">,</span><span class="w"> </span><span class="ss">:index</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="2824999653-1">)</span><span class="w">
</span><span class="s">&quot;/users/42/posts?active=true&quot;</span></code></pre>
<h2 id="scoped-routes" class="section-heading">
  <a href="#scoped-routes" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Scoped Routes
</h2>

<p>Scopes are a way to group routes under a common path prefix and scoped set of plug middleware. We might want to do this for admin functionality, APIs, and especially for versioned APIs. Let&#39;s say we have user generated reviews on a site, and that those reviews first need to be approved by an admin. The semantics of these resources are quite different, and they might not share the same controller. Scopes enable us to segregate these routes.</p>
<p>The paths to the user facing reviews would look like a standard resource.</p>
<pre><code class="console">/reviews
/reviews/1234
/reviews/1234/edit
...</code></pre>
<p>The admin review paths could be prefixed with <code class="inline">/admin</code>.</p>
<pre><code class="console">/admin/reviews
/admin/reviews/1234
/admin/reviews/1234/edit
...</code></pre>
<p>We accomplish this with a scoped route that sets a path option to <code class="inline">/admin</code> like this one. For now, let&#39;s not nest this scope inside of any other scopes (like the <code class="inline">scope &quot;/&quot;, HelloWeb do</code> one provided for us in a new app).</p>
<pre><code class="nohighlight makeup elixir"><span class="n">scope</span><span class="w"> </span><span class="s">&quot;/admin&quot;</span><span class="w"> </span><span class="k" data-group-id="7002465481-1">do</span><span class="w">
  </span><span class="n">pipe_through</span><span class="w"> </span><span class="ss">:browser</span><span class="w">

  </span><span class="n">resources</span><span class="w"> </span><span class="s">&quot;/reviews&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w">
</span><span class="k" data-group-id="7002465481-1">end</span></code></pre>
<p>Note also, that the way this scope is currently defined, we need to fully qualify our controller name, <code class="inline">HelloWeb.Admin.ReviewController</code>. We&#39;ll fix that in a minute.</p>
<p>Running <a href="Mix.Tasks.Phx.Routes.html"><code class="inline">mix phx.routes</code></a> again, in addition to the previous set of routes we get the following:</p>
<pre><code class="nohighlight makeup elixir"><span class="n">...</span><span class="w">
</span><span class="n">review_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">reviews</span><span class="w">           </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w"> </span><span class="ss">:index</span><span class="w">
</span><span class="n">review_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="o">/</span><span class="n">edit</span><span class="w">  </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w"> </span><span class="ss">:edit</span><span class="w">
</span><span class="n">review_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="n">new</span><span class="w">       </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w"> </span><span class="ss">:new</span><span class="w">
</span><span class="n">review_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w"> </span><span class="ss">:show</span><span class="w">
</span><span class="n">review_path</span><span class="w">  </span><span class="nc">POST</span><span class="w">    </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">reviews</span><span class="w">           </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w"> </span><span class="ss">:create</span><span class="w">
</span><span class="n">review_path</span><span class="w">  </span><span class="nc">PATCH</span><span class="w">   </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
             </span><span class="nc">PUT</span><span class="w">     </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
</span><span class="n">review_path</span><span class="w">  </span><span class="nc">DELETE</span><span class="w">  </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w"> </span><span class="ss">:delete</span></code></pre>
<p>This looks good, but there is a problem here. Remember that we wanted both user facing reviews routes <code class="inline">/reviews</code> as well as the admin ones <code class="inline">/admin/reviews</code>. If we now include the user facing reviews in our router like this:</p>
<pre><code class="nohighlight makeup elixir"><span class="n">scope</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">HelloWeb</span><span class="w"> </span><span class="k" data-group-id="7884253389-1">do</span><span class="w">
  </span><span class="n">pipe_through</span><span class="w"> </span><span class="ss">:browser</span><span class="w">
  </span><span class="n">...</span><span class="w">
  </span><span class="n">resources</span><span class="w"> </span><span class="s">&quot;/reviews&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">ReviewController</span><span class="w">
  </span><span class="n">...</span><span class="w">
</span><span class="k" data-group-id="7884253389-1">end</span><span class="w">

</span><span class="n">scope</span><span class="w"> </span><span class="s">&quot;/admin&quot;</span><span class="w"> </span><span class="k" data-group-id="7884253389-2">do</span><span class="w">
  </span><span class="n">resources</span><span class="w"> </span><span class="s">&quot;/reviews&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w">
</span><span class="k" data-group-id="7884253389-2">end</span></code></pre>
<p>and we run <a href="Mix.Tasks.Phx.Routes.html"><code class="inline">mix phx.routes</code></a>, we get this output:</p>
<pre><code class="nohighlight makeup elixir"><span class="n">...</span><span class="w">
</span><span class="n">review_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">reviews</span><span class="w">                 </span><span class="nc">HelloWeb.ReviewController</span><span class="w"> </span><span class="ss">:index</span><span class="w">
</span><span class="n">review_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="o">/</span><span class="n">edit</span><span class="w">        </span><span class="nc">HelloWeb.ReviewController</span><span class="w"> </span><span class="ss">:edit</span><span class="w">
</span><span class="n">review_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="n">new</span><span class="w">             </span><span class="nc">HelloWeb.ReviewController</span><span class="w"> </span><span class="ss">:new</span><span class="w">
</span><span class="n">review_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="w">             </span><span class="nc">HelloWeb.ReviewController</span><span class="w"> </span><span class="ss">:show</span><span class="w">
</span><span class="n">review_path</span><span class="w">  </span><span class="nc">POST</span><span class="w">    </span><span class="o">/</span><span class="n">reviews</span><span class="w">                 </span><span class="nc">HelloWeb.ReviewController</span><span class="w"> </span><span class="ss">:create</span><span class="w">
</span><span class="n">review_path</span><span class="w">  </span><span class="nc">PATCH</span><span class="w">   </span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="w">             </span><span class="nc">HelloWeb.ReviewController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
             </span><span class="nc">PUT</span><span class="w">     </span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="w">             </span><span class="nc">HelloWeb.ReviewController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
</span><span class="n">review_path</span><span class="w">  </span><span class="nc">DELETE</span><span class="w">  </span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="w">             </span><span class="nc">HelloWeb.ReviewController</span><span class="w"> </span><span class="ss">:delete</span><span class="w">
</span><span class="n">...</span><span class="w">
</span><span class="n">review_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">reviews</span><span class="w">           </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w"> </span><span class="ss">:index</span><span class="w">
</span><span class="n">review_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="o">/</span><span class="n">edit</span><span class="w">  </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w"> </span><span class="ss">:edit</span><span class="w">
</span><span class="n">review_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="n">new</span><span class="w">       </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w"> </span><span class="ss">:new</span><span class="w">
</span><span class="n">review_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w"> </span><span class="ss">:show</span><span class="w">
</span><span class="n">review_path</span><span class="w">  </span><span class="nc">POST</span><span class="w">    </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">reviews</span><span class="w">           </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w"> </span><span class="ss">:create</span><span class="w">
</span><span class="n">review_path</span><span class="w">  </span><span class="nc">PATCH</span><span class="w">   </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
             </span><span class="nc">PUT</span><span class="w">     </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
</span><span class="n">review_path</span><span class="w">  </span><span class="nc">DELETE</span><span class="w">  </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w"> </span><span class="ss">:delete</span></code></pre>
<p>The actual routes we get all look right, except for the path helper <code class="inline">review_path</code> at the beginning of each line. We are getting the same helper for both the user facing review routes and the admin ones, which is not correct. We can fix this problem by adding an <code class="inline">as: :admin</code> option to our admin scope.</p>
<pre><code class="nohighlight makeup elixir"><span class="n">scope</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">HelloWeb</span><span class="w"> </span><span class="k" data-group-id="2950970428-1">do</span><span class="w">
  </span><span class="n">pipe_through</span><span class="w"> </span><span class="ss">:browser</span><span class="w">
  </span><span class="n">...</span><span class="w">
  </span><span class="n">resources</span><span class="w"> </span><span class="s">&quot;/reviews&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">ReviewController</span><span class="w">
  </span><span class="n">...</span><span class="w">
</span><span class="k" data-group-id="2950970428-1">end</span><span class="w">

</span><span class="n">scope</span><span class="w"> </span><span class="s">&quot;/admin&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">as</span><span class="p">:</span><span class="w"> </span><span class="ss">:admin</span><span class="w"> </span><span class="k" data-group-id="2950970428-2">do</span><span class="w">
  </span><span class="n">resources</span><span class="w"> </span><span class="s">&quot;/reviews&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w">
</span><span class="k" data-group-id="2950970428-2">end</span></code></pre>
<p><a href="Mix.Tasks.Phx.Routes.html"><code class="inline">mix phx.routes</code></a> now shows us we have what we are looking for.</p>
<pre><code class="nohighlight makeup elixir"><span class="n">...</span><span class="w">
      </span><span class="n">review_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">reviews</span><span class="w">                        </span><span class="nc">HelloWeb.ReviewController</span><span class="w"> </span><span class="ss">:index</span><span class="w">
      </span><span class="n">review_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="o">/</span><span class="n">edit</span><span class="w">               </span><span class="nc">HelloWeb.ReviewController</span><span class="w"> </span><span class="ss">:edit</span><span class="w">
      </span><span class="n">review_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="n">new</span><span class="w">                    </span><span class="nc">HelloWeb.ReviewController</span><span class="w"> </span><span class="ss">:new</span><span class="w">
      </span><span class="n">review_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="w">                    </span><span class="nc">HelloWeb.ReviewController</span><span class="w"> </span><span class="ss">:show</span><span class="w">
      </span><span class="n">review_path</span><span class="w">  </span><span class="nc">POST</span><span class="w">    </span><span class="o">/</span><span class="n">reviews</span><span class="w">                        </span><span class="nc">HelloWeb.ReviewController</span><span class="w"> </span><span class="ss">:create</span><span class="w">
      </span><span class="n">review_path</span><span class="w">  </span><span class="nc">PATCH</span><span class="w">   </span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="w">                    </span><span class="nc">HelloWeb.ReviewController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
                   </span><span class="nc">PUT</span><span class="w">     </span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="w">                    </span><span class="nc">HelloWeb.ReviewController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
      </span><span class="n">review_path</span><span class="w">  </span><span class="nc">DELETE</span><span class="w">  </span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="w">                    </span><span class="nc">HelloWeb.ReviewController</span><span class="w"> </span><span class="ss">:delete</span><span class="w">
</span><span class="n">...</span><span class="w">
</span><span class="n">admin_review_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">reviews</span><span class="w">                  </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w"> </span><span class="ss">:index</span><span class="w">
</span><span class="n">admin_review_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="o">/</span><span class="n">edit</span><span class="w">         </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w"> </span><span class="ss">:edit</span><span class="w">
</span><span class="n">admin_review_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="n">new</span><span class="w">              </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w"> </span><span class="ss">:new</span><span class="w">
</span><span class="n">admin_review_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="w">              </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w"> </span><span class="ss">:show</span><span class="w">
</span><span class="n">admin_review_path</span><span class="w">  </span><span class="nc">POST</span><span class="w">    </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">reviews</span><span class="w">                  </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w"> </span><span class="ss">:create</span><span class="w">
</span><span class="n">admin_review_path</span><span class="w">  </span><span class="nc">PATCH</span><span class="w">   </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="w">              </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
                   </span><span class="nc">PUT</span><span class="w">     </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="w">              </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
</span><span class="n">admin_review_path</span><span class="w">  </span><span class="nc">DELETE</span><span class="w">  </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="w">              </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w"> </span><span class="ss">:delete</span></code></pre>
<p>The path helpers now return what we want them to as well. Run <code class="inline">iex -S mix</code> and give it a try yourself.</p>
<pre><code class="nohighlight makeup elixir"><span class="gp unselectable">iex(1)&gt; </span><span class="nc">HelloWeb.Router.Helpers</span><span class="o">.</span><span class="n">review_path</span><span class="p" data-group-id="4935783030-1">(</span><span class="nc">HelloWeb.Endpoint</span><span class="p">,</span><span class="w"> </span><span class="ss">:index</span><span class="p" data-group-id="4935783030-1">)</span><span class="w">
</span><span class="s">&quot;/reviews&quot;</span><span class="w">

</span><span class="gp unselectable">iex(2)&gt; </span><span class="nc">HelloWeb.Router.Helpers</span><span class="o">.</span><span class="n">admin_review_path</span><span class="p" data-group-id="4935783030-2">(</span><span class="nc">HelloWeb.Endpoint</span><span class="p">,</span><span class="w"> </span><span class="ss">:show</span><span class="p">,</span><span class="w"> </span><span class="mi">1234</span><span class="p" data-group-id="4935783030-2">)</span><span class="w">
</span><span class="s">&quot;/admin/reviews/1234&quot;</span></code></pre>
<p>What if we had a number of resources that were all handled by admins? We could put all of them inside the same scope like this:</p>
<pre><code class="nohighlight makeup elixir"><span class="n">scope</span><span class="w"> </span><span class="s">&quot;/admin&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">as</span><span class="p">:</span><span class="w"> </span><span class="ss">:admin</span><span class="w"> </span><span class="k" data-group-id="3587392765-1">do</span><span class="w">
  </span><span class="n">pipe_through</span><span class="w"> </span><span class="ss">:browser</span><span class="w">

  </span><span class="n">resources</span><span class="w"> </span><span class="s">&quot;/images&quot;</span><span class="p">,</span><span class="w">  </span><span class="nc">HelloWeb.Admin.ImageController</span><span class="w">
  </span><span class="n">resources</span><span class="w"> </span><span class="s">&quot;/reviews&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w">
  </span><span class="n">resources</span><span class="w"> </span><span class="s">&quot;/users&quot;</span><span class="p">,</span><span class="w">   </span><span class="nc">HelloWeb.Admin.UserController</span><span class="w">
</span><span class="k" data-group-id="3587392765-1">end</span></code></pre>
<p>Here&#39;s what <a href="Mix.Tasks.Phx.Routes.html"><code class="inline">mix phx.routes</code></a> tells us:</p>
<pre><code class="nohighlight makeup elixir"><span class="n">...</span><span class="w">
 </span><span class="n">admin_image_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">images</span><span class="w">            </span><span class="nc">HelloWeb.Admin.ImageController</span><span class="w"> </span><span class="ss">:index</span><span class="w">
 </span><span class="n">admin_image_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="ss">:id</span><span class="o">/</span><span class="n">edit</span><span class="w">   </span><span class="nc">HelloWeb.Admin.ImageController</span><span class="w"> </span><span class="ss">:edit</span><span class="w">
 </span><span class="n">admin_image_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">new</span><span class="w">        </span><span class="nc">HelloWeb.Admin.ImageController</span><span class="w"> </span><span class="ss">:new</span><span class="w">
 </span><span class="n">admin_image_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="ss">:id</span><span class="w">        </span><span class="nc">HelloWeb.Admin.ImageController</span><span class="w"> </span><span class="ss">:show</span><span class="w">
 </span><span class="n">admin_image_path</span><span class="w">  </span><span class="nc">POST</span><span class="w">    </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">images</span><span class="w">            </span><span class="nc">HelloWeb.Admin.ImageController</span><span class="w"> </span><span class="ss">:create</span><span class="w">
 </span><span class="n">admin_image_path</span><span class="w">  </span><span class="nc">PATCH</span><span class="w">   </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="ss">:id</span><span class="w">        </span><span class="nc">HelloWeb.Admin.ImageController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
                   </span><span class="nc">PUT</span><span class="w">     </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="ss">:id</span><span class="w">        </span><span class="nc">HelloWeb.Admin.ImageController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
 </span><span class="n">admin_image_path</span><span class="w">  </span><span class="nc">DELETE</span><span class="w">  </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="ss">:id</span><span class="w">        </span><span class="nc">HelloWeb.Admin.ImageController</span><span class="w"> </span><span class="ss">:delete</span><span class="w">
</span><span class="n">admin_review_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">reviews</span><span class="w">           </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w"> </span><span class="ss">:index</span><span class="w">
</span><span class="n">admin_review_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="o">/</span><span class="n">edit</span><span class="w">  </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w"> </span><span class="ss">:edit</span><span class="w">
</span><span class="n">admin_review_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="n">new</span><span class="w">       </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w"> </span><span class="ss">:new</span><span class="w">
</span><span class="n">admin_review_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w"> </span><span class="ss">:show</span><span class="w">
</span><span class="n">admin_review_path</span><span class="w">  </span><span class="nc">POST</span><span class="w">    </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">reviews</span><span class="w">           </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w"> </span><span class="ss">:create</span><span class="w">
</span><span class="n">admin_review_path</span><span class="w">  </span><span class="nc">PATCH</span><span class="w">   </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
                   </span><span class="nc">PUT</span><span class="w">     </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
</span><span class="n">admin_review_path</span><span class="w">  </span><span class="nc">DELETE</span><span class="w">  </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.Admin.ReviewController</span><span class="w"> </span><span class="ss">:delete</span><span class="w">
  </span><span class="n">admin_user_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">users</span><span class="w">             </span><span class="nc">HelloWeb.Admin.UserController</span><span class="w"> </span><span class="ss">:index</span><span class="w">
  </span><span class="n">admin_user_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:id</span><span class="o">/</span><span class="n">edit</span><span class="w">    </span><span class="nc">HelloWeb.Admin.UserController</span><span class="w"> </span><span class="ss">:edit</span><span class="w">
  </span><span class="n">admin_user_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">new</span><span class="w">         </span><span class="nc">HelloWeb.Admin.UserController</span><span class="w"> </span><span class="ss">:new</span><span class="w">
  </span><span class="n">admin_user_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:id</span><span class="w">         </span><span class="nc">HelloWeb.Admin.UserController</span><span class="w"> </span><span class="ss">:show</span><span class="w">
  </span><span class="n">admin_user_path</span><span class="w">  </span><span class="nc">POST</span><span class="w">    </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">users</span><span class="w">             </span><span class="nc">HelloWeb.Admin.UserController</span><span class="w"> </span><span class="ss">:create</span><span class="w">
  </span><span class="n">admin_user_path</span><span class="w">  </span><span class="nc">PATCH</span><span class="w">   </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:id</span><span class="w">         </span><span class="nc">HelloWeb.Admin.UserController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
                   </span><span class="nc">PUT</span><span class="w">     </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:id</span><span class="w">         </span><span class="nc">HelloWeb.Admin.UserController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
  </span><span class="n">admin_user_path</span><span class="w">  </span><span class="nc">DELETE</span><span class="w">  </span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:id</span><span class="w">         </span><span class="nc">HelloWeb.Admin.UserController</span><span class="w"> </span><span class="ss">:delete</span></code></pre>
<p>This is great, exactly what we want, but we can make it even better. Notice that for each resource, we needed to fully qualify the controller name by prefixing it with <code class="inline">HelloWeb.Admin</code>. That&#39;s tedious and error prone. Assuming that the name of each controller begins with <code class="inline">HelloWeb.Admin</code>, then we can add a <code class="inline">HelloWeb.Admin</code> option to our scope declaration just after the scope path, and all of our routes will have the correct, fully qualified controller name.</p>
<pre><code class="nohighlight makeup elixir"><span class="n">scope</span><span class="w"> </span><span class="s">&quot;/admin&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">HelloWeb.Admin</span><span class="p">,</span><span class="w"> </span><span class="ss">as</span><span class="p">:</span><span class="w"> </span><span class="ss">:admin</span><span class="w"> </span><span class="k" data-group-id="9728342394-1">do</span><span class="w">
  </span><span class="n">pipe_through</span><span class="w"> </span><span class="ss">:browser</span><span class="w">

  </span><span class="n">resources</span><span class="w"> </span><span class="s">&quot;/images&quot;</span><span class="p">,</span><span class="w">  </span><span class="nc">ImageController</span><span class="w">
  </span><span class="n">resources</span><span class="w"> </span><span class="s">&quot;/reviews&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">ReviewController</span><span class="w">
  </span><span class="n">resources</span><span class="w"> </span><span class="s">&quot;/users&quot;</span><span class="p">,</span><span class="w">   </span><span class="nc">UserController</span><span class="w">
</span><span class="k" data-group-id="9728342394-1">end</span></code></pre>
<p>Now run <a href="Mix.Tasks.Phx.Routes.html"><code class="inline">mix phx.routes</code></a> again and you can see that we get the same result as above when we qualified each controller name individually.</p>
<p>This doesn&#39;t just apply to nested routes, we can even nest all of the routes for our application inside a scope that simply has an alias for the name of our Phoenix app, and eliminate the duplication of our application name in our controller names.</p>
<p>Phoenix already does this for us in the generated router for a new application (see beginning of this section). Notice here the use of <code class="inline">HelloWeb</code> in the <code class="inline">scope</code> declaration:</p>
<pre><code class="nohighlight makeup elixir"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">HelloWeb.Router</span><span class="w"> </span><span class="k" data-group-id="5078683942-1">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">HelloWeb</span><span class="p">,</span><span class="w"> </span><span class="ss">:router</span><span class="w">

  </span><span class="n">scope</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">HelloWeb</span><span class="w"> </span><span class="k" data-group-id="5078683942-2">do</span><span class="w">
    </span><span class="n">pipe_through</span><span class="w"> </span><span class="ss">:browser</span><span class="w">

    </span><span class="n">get</span><span class="w"> </span><span class="s">&quot;/images&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">ImageController</span><span class="p">,</span><span class="w"> </span><span class="ss">:index</span><span class="w">
    </span><span class="n">resources</span><span class="w"> </span><span class="s">&quot;/reviews&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">ReviewController</span><span class="w">
    </span><span class="n">resources</span><span class="w"> </span><span class="s">&quot;/users&quot;</span><span class="p">,</span><span class="w">   </span><span class="nc">UserController</span><span class="w">
  </span><span class="k" data-group-id="5078683942-2">end</span><span class="w">
</span><span class="k" data-group-id="5078683942-1">end</span></code></pre>
<p>Again <a href="Mix.Tasks.Phx.Routes.html"><code class="inline">mix phx.routes</code></a> tells us that all of our controllers now have the correct, fully-qualified names.</p>
<pre><code class="nohighlight makeup elixir"><span class="w"> </span><span class="n">image_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">images</span><span class="w">            </span><span class="nc">HelloWeb.ImageController</span><span class="w"> </span><span class="ss">:index</span><span class="w">
</span><span class="n">review_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">reviews</span><span class="w">           </span><span class="nc">HelloWeb.ReviewController</span><span class="w"> </span><span class="ss">:index</span><span class="w">
</span><span class="n">review_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="o">/</span><span class="n">edit</span><span class="w">  </span><span class="nc">HelloWeb.ReviewController</span><span class="w"> </span><span class="ss">:edit</span><span class="w">
</span><span class="n">review_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="n">new</span><span class="w">       </span><span class="nc">HelloWeb.ReviewController</span><span class="w"> </span><span class="ss">:new</span><span class="w">
</span><span class="n">review_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.ReviewController</span><span class="w"> </span><span class="ss">:show</span><span class="w">
</span><span class="n">review_path</span><span class="w">  </span><span class="nc">POST</span><span class="w">    </span><span class="o">/</span><span class="n">reviews</span><span class="w">           </span><span class="nc">HelloWeb.ReviewController</span><span class="w"> </span><span class="ss">:create</span><span class="w">
</span><span class="n">review_path</span><span class="w">  </span><span class="nc">PATCH</span><span class="w">   </span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.ReviewController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
             </span><span class="nc">PUT</span><span class="w">     </span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.ReviewController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
</span><span class="n">review_path</span><span class="w">  </span><span class="nc">DELETE</span><span class="w">  </span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.ReviewController</span><span class="w"> </span><span class="ss">:delete</span><span class="w">
  </span><span class="n">user_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">users</span><span class="w">             </span><span class="nc">HelloWeb.UserController</span><span class="w"> </span><span class="ss">:index</span><span class="w">
  </span><span class="n">user_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:id</span><span class="o">/</span><span class="n">edit</span><span class="w">    </span><span class="nc">HelloWeb.UserController</span><span class="w"> </span><span class="ss">:edit</span><span class="w">
  </span><span class="n">user_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">new</span><span class="w">         </span><span class="nc">HelloWeb.UserController</span><span class="w"> </span><span class="ss">:new</span><span class="w">
  </span><span class="n">user_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:id</span><span class="w">         </span><span class="nc">HelloWeb.UserController</span><span class="w"> </span><span class="ss">:show</span><span class="w">
  </span><span class="n">user_path</span><span class="w">  </span><span class="nc">POST</span><span class="w">    </span><span class="o">/</span><span class="n">users</span><span class="w">             </span><span class="nc">HelloWeb.UserController</span><span class="w"> </span><span class="ss">:create</span><span class="w">
  </span><span class="n">user_path</span><span class="w">  </span><span class="nc">PATCH</span><span class="w">   </span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:id</span><span class="w">         </span><span class="nc">HelloWeb.UserController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
             </span><span class="nc">PUT</span><span class="w">     </span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:id</span><span class="w">         </span><span class="nc">HelloWeb.UserController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
  </span><span class="n">user_path</span><span class="w">  </span><span class="nc">DELETE</span><span class="w">  </span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:id</span><span class="w">         </span><span class="nc">HelloWeb.UserController</span><span class="w"> </span><span class="ss">:delete</span></code></pre>
<p>Although technically scopes can also be nested (just like resources), the use of nested scopes is generally discouraged because it can sometimes make our code confusing and less clear. With that said, suppose that we had a versioned API with resources defined for images, reviews and users. Then technically we could  setup routes for the versioned API like this:</p>
<pre><code class="nohighlight makeup elixir"><span class="n">scope</span><span class="w"> </span><span class="s">&quot;/api&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">HelloWeb.Api</span><span class="p">,</span><span class="w"> </span><span class="ss">as</span><span class="p">:</span><span class="w"> </span><span class="ss">:api</span><span class="w"> </span><span class="k" data-group-id="9777445077-1">do</span><span class="w">
  </span><span class="n">pipe_through</span><span class="w"> </span><span class="ss">:api</span><span class="w">

  </span><span class="n">scope</span><span class="w"> </span><span class="s">&quot;/v1&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">V1</span><span class="p">,</span><span class="w"> </span><span class="ss">as</span><span class="p">:</span><span class="w"> </span><span class="ss">:v1</span><span class="w"> </span><span class="k" data-group-id="9777445077-2">do</span><span class="w">
    </span><span class="n">resources</span><span class="w"> </span><span class="s">&quot;/images&quot;</span><span class="p">,</span><span class="w">  </span><span class="nc">ImageController</span><span class="w">
    </span><span class="n">resources</span><span class="w"> </span><span class="s">&quot;/reviews&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">ReviewController</span><span class="w">
    </span><span class="n">resources</span><span class="w"> </span><span class="s">&quot;/users&quot;</span><span class="p">,</span><span class="w">   </span><span class="nc">UserController</span><span class="w">
  </span><span class="k" data-group-id="9777445077-2">end</span><span class="w">
</span><span class="k" data-group-id="9777445077-1">end</span></code></pre>
<p><a href="Mix.Tasks.Phx.Routes.html"><code class="inline">mix phx.routes</code></a> tells us that we have the routes we&#39;re looking for.</p>
<pre><code class="nohighlight makeup elixir"><span class="w"> </span><span class="n">api_v1_image_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">images</span><span class="w">            </span><span class="nc">HelloWeb.Api.V1.ImageController</span><span class="w"> </span><span class="ss">:index</span><span class="w">
 </span><span class="n">api_v1_image_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="ss">:id</span><span class="o">/</span><span class="n">edit</span><span class="w">   </span><span class="nc">HelloWeb.Api.V1.ImageController</span><span class="w"> </span><span class="ss">:edit</span><span class="w">
 </span><span class="n">api_v1_image_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">new</span><span class="w">        </span><span class="nc">HelloWeb.Api.V1.ImageController</span><span class="w"> </span><span class="ss">:new</span><span class="w">
 </span><span class="n">api_v1_image_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="ss">:id</span><span class="w">        </span><span class="nc">HelloWeb.Api.V1.ImageController</span><span class="w"> </span><span class="ss">:show</span><span class="w">
 </span><span class="n">api_v1_image_path</span><span class="w">  </span><span class="nc">POST</span><span class="w">    </span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">images</span><span class="w">            </span><span class="nc">HelloWeb.Api.V1.ImageController</span><span class="w"> </span><span class="ss">:create</span><span class="w">
 </span><span class="n">api_v1_image_path</span><span class="w">  </span><span class="nc">PATCH</span><span class="w">   </span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="ss">:id</span><span class="w">        </span><span class="nc">HelloWeb.Api.V1.ImageController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
                    </span><span class="nc">PUT</span><span class="w">     </span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="ss">:id</span><span class="w">        </span><span class="nc">HelloWeb.Api.V1.ImageController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
 </span><span class="n">api_v1_image_path</span><span class="w">  </span><span class="nc">DELETE</span><span class="w">  </span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="ss">:id</span><span class="w">        </span><span class="nc">HelloWeb.Api.V1.ImageController</span><span class="w"> </span><span class="ss">:delete</span><span class="w">
</span><span class="n">api_v1_review_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">reviews</span><span class="w">           </span><span class="nc">HelloWeb.Api.V1.ReviewController</span><span class="w"> </span><span class="ss">:index</span><span class="w">
</span><span class="n">api_v1_review_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="o">/</span><span class="n">edit</span><span class="w">  </span><span class="nc">HelloWeb.Api.V1.ReviewController</span><span class="w"> </span><span class="ss">:edit</span><span class="w">
</span><span class="n">api_v1_review_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="n">new</span><span class="w">       </span><span class="nc">HelloWeb.Api.V1.ReviewController</span><span class="w"> </span><span class="ss">:new</span><span class="w">
</span><span class="n">api_v1_review_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.Api.V1.ReviewController</span><span class="w"> </span><span class="ss">:show</span><span class="w">
</span><span class="n">api_v1_review_path</span><span class="w">  </span><span class="nc">POST</span><span class="w">    </span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">reviews</span><span class="w">           </span><span class="nc">HelloWeb.Api.V1.ReviewController</span><span class="w"> </span><span class="ss">:create</span><span class="w">
</span><span class="n">api_v1_review_path</span><span class="w">  </span><span class="nc">PATCH</span><span class="w">   </span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.Api.V1.ReviewController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
                    </span><span class="nc">PUT</span><span class="w">     </span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.Api.V1.ReviewController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
</span><span class="n">api_v1_review_path</span><span class="w">  </span><span class="nc">DELETE</span><span class="w">  </span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">reviews</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.Api.V1.ReviewController</span><span class="w"> </span><span class="ss">:delete</span><span class="w">
  </span><span class="n">api_v1_user_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">users</span><span class="w">             </span><span class="nc">HelloWeb.Api.V1.UserController</span><span class="w"> </span><span class="ss">:index</span><span class="w">
  </span><span class="n">api_v1_user_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:id</span><span class="o">/</span><span class="n">edit</span><span class="w">    </span><span class="nc">HelloWeb.Api.V1.UserController</span><span class="w"> </span><span class="ss">:edit</span><span class="w">
  </span><span class="n">api_v1_user_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">new</span><span class="w">         </span><span class="nc">HelloWeb.Api.V1.UserController</span><span class="w"> </span><span class="ss">:new</span><span class="w">
  </span><span class="n">api_v1_user_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:id</span><span class="w">         </span><span class="nc">HelloWeb.Api.V1.UserController</span><span class="w"> </span><span class="ss">:show</span><span class="w">
  </span><span class="n">api_v1_user_path</span><span class="w">  </span><span class="nc">POST</span><span class="w">    </span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">users</span><span class="w">             </span><span class="nc">HelloWeb.Api.V1.UserController</span><span class="w"> </span><span class="ss">:create</span><span class="w">
  </span><span class="n">api_v1_user_path</span><span class="w">  </span><span class="nc">PATCH</span><span class="w">   </span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:id</span><span class="w">         </span><span class="nc">HelloWeb.Api.V1.UserController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
                    </span><span class="nc">PUT</span><span class="w">     </span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:id</span><span class="w">         </span><span class="nc">HelloWeb.Api.V1.UserController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
  </span><span class="n">api_v1_user_path</span><span class="w">  </span><span class="nc">DELETE</span><span class="w">  </span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:id</span><span class="w">         </span><span class="nc">HelloWeb.Api.V1.UserController</span><span class="w"> </span><span class="ss">:delete</span></code></pre>
<p>Interestingly, we can use multiple scopes with the same path as long as we are careful not to duplicate routes. If we do duplicate a route, we&#39;ll get this familiar warning.</p>
<pre><code class="console">warning: this clause cannot match because a previous clause at line 16 always matches</code></pre>
<p>This router is perfectly fine with two scopes defined for the same path.</p>
<pre><code class="nohighlight makeup elixir"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">HelloWeb.Router</span><span class="w"> </span><span class="k" data-group-id="7139922604-1">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">Phoenix.Router</span><span class="w">
  </span><span class="n">...</span><span class="w">
  </span><span class="n">scope</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">HelloWeb</span><span class="w"> </span><span class="k" data-group-id="7139922604-2">do</span><span class="w">
    </span><span class="n">pipe_through</span><span class="w"> </span><span class="ss">:browser</span><span class="w">

    </span><span class="n">resources</span><span class="w"> </span><span class="s">&quot;/users&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">UserController</span><span class="w">
  </span><span class="k" data-group-id="7139922604-2">end</span><span class="w">

  </span><span class="n">scope</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">AnotherAppWeb</span><span class="w"> </span><span class="k" data-group-id="7139922604-3">do</span><span class="w">
    </span><span class="n">pipe_through</span><span class="w"> </span><span class="ss">:browser</span><span class="w">

    </span><span class="n">resources</span><span class="w"> </span><span class="s">&quot;/posts&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">PostController</span><span class="w">
  </span><span class="k" data-group-id="7139922604-3">end</span><span class="w">
  </span><span class="n">...</span><span class="w">
</span><span class="k" data-group-id="7139922604-1">end</span></code></pre>
<p>And when we run <a href="Mix.Tasks.Phx.Routes.html"><code class="inline">mix phx.routes</code></a>, we see the following output.</p>
<pre><code class="nohighlight makeup elixir"><span class="n">user_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">users</span><span class="w">           </span><span class="nc">HelloWeb.UserController</span><span class="w"> </span><span class="ss">:index</span><span class="w">
</span><span class="n">user_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:id</span><span class="o">/</span><span class="n">edit</span><span class="w">  </span><span class="nc">HelloWeb.UserController</span><span class="w"> </span><span class="ss">:edit</span><span class="w">
</span><span class="n">user_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">new</span><span class="w">       </span><span class="nc">HelloWeb.UserController</span><span class="w"> </span><span class="ss">:new</span><span class="w">
</span><span class="n">user_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.UserController</span><span class="w"> </span><span class="ss">:show</span><span class="w">
</span><span class="n">user_path</span><span class="w">  </span><span class="nc">POST</span><span class="w">    </span><span class="o">/</span><span class="n">users</span><span class="w">           </span><span class="nc">HelloWeb.UserController</span><span class="w"> </span><span class="ss">:create</span><span class="w">
</span><span class="n">user_path</span><span class="w">  </span><span class="nc">PATCH</span><span class="w">   </span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.UserController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
           </span><span class="nc">PUT</span><span class="w">     </span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.UserController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
</span><span class="n">user_path</span><span class="w">  </span><span class="nc">DELETE</span><span class="w">  </span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">HelloWeb.UserController</span><span class="w"> </span><span class="ss">:delete</span><span class="w">
</span><span class="n">post_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">posts</span><span class="w">           </span><span class="nc">AnotherAppWeb.PostController</span><span class="w"> </span><span class="ss">:index</span><span class="w">
</span><span class="n">post_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">posts</span><span class="o">/</span><span class="ss">:id</span><span class="o">/</span><span class="n">edit</span><span class="w">  </span><span class="nc">AnotherAppWeb.PostController</span><span class="w"> </span><span class="ss">:edit</span><span class="w">
</span><span class="n">post_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">posts</span><span class="o">/</span><span class="n">new</span><span class="w">       </span><span class="nc">AnotherAppWeb.PostController</span><span class="w"> </span><span class="ss">:new</span><span class="w">
</span><span class="n">post_path</span><span class="w">  </span><span class="nc">GET</span><span class="w">     </span><span class="o">/</span><span class="n">posts</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">AnotherAppWeb.PostController</span><span class="w"> </span><span class="ss">:show</span><span class="w">
</span><span class="n">post_path</span><span class="w">  </span><span class="nc">POST</span><span class="w">    </span><span class="o">/</span><span class="n">posts</span><span class="w">           </span><span class="nc">AnotherAppWeb.PostController</span><span class="w"> </span><span class="ss">:create</span><span class="w">
</span><span class="n">post_path</span><span class="w">  </span><span class="nc">PATCH</span><span class="w">   </span><span class="o">/</span><span class="n">posts</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">AnotherAppWeb.PostController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
           </span><span class="nc">PUT</span><span class="w">     </span><span class="o">/</span><span class="n">posts</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">AnotherAppWeb.PostController</span><span class="w"> </span><span class="ss">:update</span><span class="w">
</span><span class="n">post_path</span><span class="w">  </span><span class="nc">DELETE</span><span class="w">  </span><span class="o">/</span><span class="n">posts</span><span class="o">/</span><span class="ss">:id</span><span class="w">       </span><span class="nc">AnotherAppWeb.PostController</span><span class="w"> </span><span class="ss">:delete</span></code></pre>
<h2 id="pipelines" class="section-heading">
  <a href="#pipelines" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Pipelines
</h2>

<p>We have come quite a long way in this guide without talking about one of the first lines we saw in the router - <code class="inline">pipe_through :browser</code>. It&#39;s time to fix that.</p>
<p>Remember in the <a href="overview.html">Overview Guide</a> when we described plugs as being stacked and executable in a pre-determined order, like a pipeline? Now we&#39;re going to take a closer look at how these plug stacks work in the router.</p>
<p>Pipelines are simply plugs stacked up together in a specific order and given a name. They allow us to customize behaviors and transformations related to the handling of requests. Phoenix provides us with some default pipelines for a number of common tasks. In turn we can customize them as well as create new pipelines to meet our needs.</p>
<p>A newly generated Phoenix application defines two pipelines called <code class="inline">:browser</code> and <code class="inline">:api</code>. We&#39;ll get to those in a minute, but first we need to talk about the plug stack in the Endpoint plugs.</p>
<h4>The Endpoint Plugs</h4>
<p>Endpoints organize all the plugs common to every request, and apply them before dispatching into the router(s) with their underlying <code class="inline">:browser</code>, <code class="inline">:api</code>, and custom pipelines. The default Endpoint plugs do quite a lot of work. Here they are in order.</p>
<ul>
<li><p><a href="https://hexdocs.pm/plug/Plug.Static.html">Plug.Static</a> - serves static assets. Since this plug comes before the logger, serving of static assets is not logged</p>
</li>
<li><p><a href="https://hexdocs.pm/phoenix/Phoenix.CodeReloader.html">Phoenix.CodeReloader</a> - a plug that enables code reloading for all entries in the web directory. It is configured directly in the Phoenix application</p>
</li>
<li><p><a href="https://hexdocs.pm/plug/Plug.RequestId.html">Plug.RequestId</a> - generates a unique request id for each request.</p>
</li>
<li><p><a href="https://hexdocs.pm/plug/Plug.Logger.html">Plug.Logger</a> - logs incoming requests</p>
</li>
<li><p><a href="https://hexdocs.pm/plug/Plug.Parsers.html">Plug.Parsers</a> - parses the request body when a known parser is available. By default parsers parse urlencoded, multipart and json (with <code class="inline">jason</code>). The request body is left untouched when the request content-type cannot be parsed</p>
</li>
<li><p><a href="https://hexdocs.pm/plug/Plug.MethodOverride.html">Plug.MethodOverride</a> - converts the request method to
PUT, PATCH or DELETE for POST requests with a valid <code class="inline">_method</code> parameter</p>
</li>
<li><p><a href="https://hexdocs.pm/plug/Plug.Head.html">Plug.Head</a> - converts HEAD requests to GET requests and strips the response body</p>
</li>
<li><p><a href="https://hexdocs.pm/plug/Plug.Session.html">Plug.Session</a> - a plug that sets up session management.
Note that <code class="inline">fetch_session/2</code> must still be explicitly called before using the session as this plug just sets up how the session is fetched</p>
</li>
<li><p><a href="https://hexdocs.pm/plug/Plug.Router.html">Plug.Router</a> - plugs a router into the request cycle</p>
</li>
</ul>
<h4>The <code class="inline">:browser</code> and <code class="inline">:api</code> Pipelines</h4>
<p>Phoenix defines two other pipelines by default, <code class="inline">:browser</code> and <code class="inline">:api</code>. The router will invoke these after it matches a route, assuming we have called <code class="inline">pipe_through/1</code> with them in the enclosing scope.</p>
<p>As their names suggest, the <code class="inline">:browser</code> pipeline prepares for routes which render requests for a browser. The <code class="inline">:api</code> pipeline prepares for routes which produce data for an api.</p>
<p>The <code class="inline">:browser</code> pipeline has five plugs: <code class="inline">plug :accepts, [&quot;html&quot;]</code> which defines the request format or formats which will be accepted, <code class="inline">:fetch_session</code>, which, naturally, fetches the session data and makes it available in the connection, <code class="inline">:fetch_flash</code> which retrieves any flash messages which may have been set, as well as <code class="inline">:protect_from_forgery</code> and <code class="inline">:put_secure_browser_headers</code>, which protects form posts from cross site forgery.</p>
<p>Currently, the <code class="inline">:api</code> pipeline only defines <code class="inline">plug :accepts, [&quot;json&quot;]</code>.</p>
<p>The router invokes a pipeline on a route defined within a scope. If no scope is defined, the router will invoke the pipeline on all the routes in the router. Although the use of nested scopes is discouraged (see above), if we call <code class="inline">pipe_through</code> within a nested scope, the router will invoke all <code class="inline">pipe_through</code>&#39;s from parent scopes, followed by the nested one.</p>
<p>Those are a lot of words bunched up together. Let&#39;s take a look at some examples to untangle their meaning.</p>
<p>Here&#39;s another look at the router from a newly generated Phoenix application, this time with the api scope uncommented back in and a route added.</p>
<pre><code class="nohighlight makeup elixir"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">HelloWeb.Router</span><span class="w"> </span><span class="k" data-group-id="8991620815-1">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">HelloWeb</span><span class="p">,</span><span class="w"> </span><span class="ss">:router</span><span class="w">

  </span><span class="n">pipeline</span><span class="w"> </span><span class="ss">:browser</span><span class="w"> </span><span class="k" data-group-id="8991620815-2">do</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:accepts</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8991620815-3">[</span><span class="s">&quot;html&quot;</span><span class="p" data-group-id="8991620815-3">]</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:fetch_session</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:fetch_flash</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:protect_from_forgery</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:put_secure_browser_headers</span><span class="w">
  </span><span class="k" data-group-id="8991620815-2">end</span><span class="w">

  </span><span class="n">pipeline</span><span class="w"> </span><span class="ss">:api</span><span class="w"> </span><span class="k" data-group-id="8991620815-4">do</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:accepts</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8991620815-5">[</span><span class="s">&quot;json&quot;</span><span class="p" data-group-id="8991620815-5">]</span><span class="w">
  </span><span class="k" data-group-id="8991620815-4">end</span><span class="w">

  </span><span class="n">scope</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">HelloWeb</span><span class="w"> </span><span class="k" data-group-id="8991620815-6">do</span><span class="w">
    </span><span class="n">pipe_through</span><span class="w"> </span><span class="ss">:browser</span><span class="w">

    </span><span class="n">get</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">PageController</span><span class="p">,</span><span class="w"> </span><span class="ss">:index</span><span class="w">
  </span><span class="k" data-group-id="8991620815-6">end</span><span class="w">

  </span><span class="c1"># Other scopes may use custom stacks.</span><span class="w">
  </span><span class="n">scope</span><span class="w"> </span><span class="s">&quot;/api&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">HelloWeb</span><span class="w"> </span><span class="k" data-group-id="8991620815-7">do</span><span class="w">
    </span><span class="n">pipe_through</span><span class="w"> </span><span class="ss">:api</span><span class="w">

    </span><span class="n">resources</span><span class="w"> </span><span class="s">&quot;/reviews&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">ReviewController</span><span class="w">
  </span><span class="k" data-group-id="8991620815-7">end</span><span class="w">
</span><span class="k" data-group-id="8991620815-1">end</span></code></pre>
<p>When the server accepts a request, the request will always first pass through the plugs in our Endpoint, after which it will attempt to match on the path and HTTP verb.</p>
<p>Let&#39;s say that the request matches our first route: a GET to <code class="inline">/</code>. The router will first pipe that request through the <code class="inline">:browser</code> pipeline - which will fetch the session data, fetch the flash, and execute forgery protection - before it dispatches the request to the <code class="inline">PageController</code> <code class="inline">index</code> action.</p>
<p>Conversely, if the request matches any of the routes defined by the <code class="inline">resources/2</code> macro, the router will pipe it through the <code class="inline">:api</code> pipeline - which currently does nothing - before it dispatches further to the correct action of the <code class="inline">HelloWeb.ReviewController</code>.</p>
<p>If we know that our application only renders views for the browser, we can simplify our router quite a bit by removing the <code class="inline">api</code> stuff as well as the scopes:</p>
<pre><code class="nohighlight makeup elixir"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">HelloWeb.Router</span><span class="w"> </span><span class="k" data-group-id="3374526199-1">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">HelloWeb</span><span class="p">,</span><span class="w"> </span><span class="ss">:router</span><span class="w">

  </span><span class="n">pipeline</span><span class="w"> </span><span class="ss">:browser</span><span class="w"> </span><span class="k" data-group-id="3374526199-2">do</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:accepts</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3374526199-3">[</span><span class="s">&quot;html&quot;</span><span class="p" data-group-id="3374526199-3">]</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:fetch_session</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:fetch_flash</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:protect_from_forgery</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:put_secure_browser_headers</span><span class="w">
  </span><span class="k" data-group-id="3374526199-2">end</span><span class="w">

  </span><span class="n">pipe_through</span><span class="w"> </span><span class="ss">:browser</span><span class="w">

  </span><span class="n">get</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">HelloWeb.PageController</span><span class="p">,</span><span class="w"> </span><span class="ss">:index</span><span class="w">

  </span><span class="n">resources</span><span class="w"> </span><span class="s">&quot;/reviews&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">HelloWeb.ReviewController</span><span class="w">
</span><span class="k" data-group-id="3374526199-1">end</span></code></pre>
<p>Removing all scopes forces the router to invoke the <code class="inline">:browser</code> pipeline on all routes.</p>
<p>Let&#39;s stretch these ideas out a little bit more. What if we need to pipe requests through both <code class="inline">:browser</code> and one or more custom pipelines? We simply <code class="inline">pipe_through</code> a list of pipelines, and Phoenix will invoke them in order.</p>
<pre><code class="nohighlight makeup elixir"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">HelloWeb.Router</span><span class="w"> </span><span class="k" data-group-id="1117464019-1">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">HelloWeb</span><span class="p">,</span><span class="w"> </span><span class="ss">:router</span><span class="w">

  </span><span class="n">pipeline</span><span class="w"> </span><span class="ss">:browser</span><span class="w"> </span><span class="k" data-group-id="1117464019-2">do</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:accepts</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1117464019-3">[</span><span class="s">&quot;html&quot;</span><span class="p" data-group-id="1117464019-3">]</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:fetch_session</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:fetch_flash</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:protect_from_forgery</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:put_secure_browser_headers</span><span class="w">
  </span><span class="k" data-group-id="1117464019-2">end</span><span class="w">
  </span><span class="n">...</span><span class="w">

  </span><span class="n">scope</span><span class="w"> </span><span class="s">&quot;/reviews&quot;</span><span class="w"> </span><span class="k" data-group-id="1117464019-4">do</span><span class="w">
    </span><span class="n">pipe_through</span><span class="w"> </span><span class="p" data-group-id="1117464019-5">[</span><span class="ss">:browser</span><span class="p">,</span><span class="w"> </span><span class="ss">:review_checks</span><span class="p">,</span><span class="w"> </span><span class="ss">:other_great_stuff</span><span class="p" data-group-id="1117464019-5">]</span><span class="w">

    </span><span class="n">resources</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">HelloWeb.ReviewController</span><span class="w">
  </span><span class="k" data-group-id="1117464019-4">end</span><span class="w">
</span><span class="k" data-group-id="1117464019-1">end</span></code></pre>
<p>Here&#39;s another example with two scopes that have different pipelines:</p>
<pre><code class="nohighlight makeup elixir"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">HelloWeb.Router</span><span class="w"> </span><span class="k" data-group-id="9537253131-1">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">HelloWeb</span><span class="p">,</span><span class="w"> </span><span class="ss">:router</span><span class="w">

  </span><span class="n">pipeline</span><span class="w"> </span><span class="ss">:browser</span><span class="w"> </span><span class="k" data-group-id="9537253131-2">do</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:accepts</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9537253131-3">[</span><span class="s">&quot;html&quot;</span><span class="p" data-group-id="9537253131-3">]</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:fetch_session</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:fetch_flash</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:protect_from_forgery</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:put_secure_browser_headers</span><span class="w">
  </span><span class="k" data-group-id="9537253131-2">end</span><span class="w">
  </span><span class="n">...</span><span class="w">

  </span><span class="n">scope</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">HelloWeb</span><span class="w"> </span><span class="k" data-group-id="9537253131-4">do</span><span class="w">
    </span><span class="n">pipe_through</span><span class="w"> </span><span class="ss">:browser</span><span class="w">

    </span><span class="n">resources</span><span class="w"> </span><span class="s">&quot;/posts&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">PostController</span><span class="w">
  </span><span class="k" data-group-id="9537253131-4">end</span><span class="w">

  </span><span class="n">scope</span><span class="w"> </span><span class="s">&quot;/reviews&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">HelloWeb</span><span class="w"> </span><span class="k" data-group-id="9537253131-5">do</span><span class="w">
    </span><span class="n">pipe_through</span><span class="w"> </span><span class="p" data-group-id="9537253131-6">[</span><span class="ss">:browser</span><span class="p">,</span><span class="w"> </span><span class="ss">:review_checks</span><span class="p" data-group-id="9537253131-6">]</span><span class="w">

    </span><span class="n">resources</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">ReviewController</span><span class="w">
  </span><span class="k" data-group-id="9537253131-5">end</span><span class="w">
</span><span class="k" data-group-id="9537253131-1">end</span></code></pre>
<p>In general, the scoping rules for pipelines behave as you might expect. In this example, all routes will pipe through the <code class="inline">:browser</code> pipeline. However, only the <code class="inline">reviews</code> resources routes will  pipe through the <code class="inline">:review_checks</code> pipeline. Since we declared both pipes <code class="inline">pipe_through [:browser, :review_checks]</code> in a list of pipelines, Phoenix will <code class="inline">pipe_through</code> each of them as it invokes them in order.</p>
<h4>Creating New Pipelines</h4>
<p>Phoenix allows us to create our own custom pipelines anywhere in the router. To do so, we call the <code class="inline">pipeline/2</code> macro with these arguments: an atom for the name of our new pipeline and a block with all the plugs we want in it.</p>
<pre><code class="nohighlight makeup elixir"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">HelloWeb.Router</span><span class="w"> </span><span class="k" data-group-id="1246807546-1">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">HelloWeb</span><span class="p">,</span><span class="w"> </span><span class="ss">:router</span><span class="w">

  </span><span class="n">pipeline</span><span class="w"> </span><span class="ss">:browser</span><span class="w"> </span><span class="k" data-group-id="1246807546-2">do</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:accepts</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1246807546-3">[</span><span class="s">&quot;html&quot;</span><span class="p" data-group-id="1246807546-3">]</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:fetch_session</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:fetch_flash</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:protect_from_forgery</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:put_secure_browser_headers</span><span class="w">
  </span><span class="k" data-group-id="1246807546-2">end</span><span class="w">

  </span><span class="n">pipeline</span><span class="w"> </span><span class="ss">:review_checks</span><span class="w"> </span><span class="k" data-group-id="1246807546-4">do</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:ensure_authenticated_user</span><span class="w">
    </span><span class="n">plug</span><span class="w"> </span><span class="ss">:ensure_user_owns_review</span><span class="w">
  </span><span class="k" data-group-id="1246807546-4">end</span><span class="w">

  </span><span class="n">scope</span><span class="w"> </span><span class="s">&quot;/reviews&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">HelloWeb</span><span class="w"> </span><span class="k" data-group-id="1246807546-5">do</span><span class="w">
    </span><span class="n">pipe_through</span><span class="w"> </span><span class="ss">:review_checks</span><span class="w">

    </span><span class="n">resources</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">ReviewController</span><span class="w">
  </span><span class="k" data-group-id="1246807546-5">end</span><span class="w">
</span><span class="k" data-group-id="1246807546-1">end</span></code></pre>
<h2 id="channel-routes" class="section-heading">
  <a href="#channel-routes" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Channel Routes
</h2>

<p>Channels are a very exciting, real-time component of the Phoenix framework. Channels handle incoming and outgoing messages broadcast over a socket for a given topic. Channel routes, then, need to match requests by socket and topic in order to dispatch to the correct channel. (For a more detailed description of channels and their behavior, please see the <a href="channels.html">Channel Guide</a>.)</p>
<p>We mount socket handlers in our endpoint at <code class="inline">lib/hello_web/endpoint.ex</code>. Socket handlers take care of authentication callbacks and channel routes.</p>
<pre><code class="nohighlight makeup elixir"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">HelloWeb.Endpoint</span><span class="w"> </span><span class="k" data-group-id="8952118948-1">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">Phoenix.Endpoint</span><span class="p">,</span><span class="w"> </span><span class="ss">otp_app</span><span class="p">:</span><span class="w"> </span><span class="ss">:hello</span><span class="w">

  </span><span class="n">socket</span><span class="w"> </span><span class="s">&quot;/socket&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">HelloWeb.UserSocket</span><span class="p">,</span><span class="w">
    </span><span class="ss">websocket</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p">,</span><span class="w">
    </span><span class="ss">longpoll</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="w">
  </span><span class="n">...</span><span class="w">
</span><span class="k" data-group-id="8952118948-1">end</span></code></pre>
<p>By default, Phoenix supports both websockets and longpoll when invoking <a href="Phoenix.Endpoint.html#socket/3"><code class="inline">Phoenix.Endpoint.socket/3</code></a> in your endpoint. Here we&#39;re specifying that incoming socket connections can be made via a WebSocket connection.</p>
<p>Next, we need to open our <code class="inline">lib/hello_web/channels/user_socket.ex</code> file and use the <code class="inline">channel/3</code> macro to define our channel routes. The routes will match a topic pattern to a channel to handle events. If we have a channel module called <code class="inline">RoomChannel</code> and a topic called <code class="inline">&quot;rooms:*&quot;</code>, the code to do this is straightforward.</p>
<pre><code class="nohighlight makeup elixir"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">HelloWeb.UserSocket</span><span class="w"> </span><span class="k" data-group-id="6678743106-1">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">Phoenix.Socket</span><span class="w">

  </span><span class="n">channel</span><span class="w"> </span><span class="s">&quot;rooms:*&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">HelloWeb.RoomChannel</span><span class="w">
  </span><span class="n">...</span><span class="w">
</span><span class="k" data-group-id="6678743106-1">end</span></code></pre>
<p>Topics are just string identifiers. The form we are using here is a convention which allows us to define topics and subtopics in the same string - &quot;topic:subtopic&quot;. The <code class="inline">*</code> is a wildcard character which allows us to match on any subtopic, so <code class="inline">&quot;rooms:lobby&quot;</code> and <code class="inline">&quot;rooms:kitchen&quot;</code> would both match this route.</p>
<p>Each socket can handle requests for multiple channels.</p>
<pre><code class="nohighlight makeup elixir"><span class="n">channel</span><span class="w"> </span><span class="s">&quot;rooms:*&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">HelloWeb.RoomChannel</span><span class="w">
</span><span class="n">channel</span><span class="w"> </span><span class="s">&quot;foods:*&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">HelloWeb.FoodChannel</span></code></pre>
<p>We can mount multiple socket handlers in our endpoint:</p>
<pre><code class="nohighlight makeup elixir"><span class="n">socket</span><span class="w"> </span><span class="s">&quot;/socket&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">HelloWeb.UserSocket</span><span class="w">
</span><span class="n">socket</span><span class="w"> </span><span class="s">&quot;/admin-socket&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">HelloWeb.AdminSocket</span></code></pre>
<h2 id="summary" class="section-heading">
  <a href="#summary" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Summary
</h2>

<p>Routing is a big topic, and we have covered a lot of ground here. The important points to take away from this guide are:</p>
<ul>
<li>Routes which begin with an HTTP verb name expand to a single clause of the match function.
</li>
<li>Routes which begin with &#39;resources&#39; expand to 8 clauses of the match function.
</li>
<li>Resources may restrict the number of match function clauses by using the <code class="inline">only:</code> or <code class="inline">except:</code> options.
</li>
<li>Any of these routes may be nested.
</li>
<li>Any of these routes may be scoped to a given path.
</li>
<li>Using the <code class="inline">as:</code> option in a scope can reduce duplication.
</li>
<li>Using the helper option for scoped routes eliminates unreachable paths.
</li>
</ul>
      <footer class="footer">
        <p>
          <span class="line">
            Built using
            <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener">ExDoc</a> (v0.21.2),
          </span>
          <span class="line">
            designed by
            <a href="https://twitter.com/dignifiedquire" target="_blank" rel="noopener" title="@dignifiedquire">Friedel Ziegelmayer</a>.
          </span>
        </p>
        <p>
          <button class="line footer-button night-mode-toggle">
            Toggle night mode
          </button>
          <button class="line footer-button tooltips-toggle">
            <span class="tooltips-option-disable">Disable tooltips</span>
            <span class="tooltips-option-enable">Enable tooltips</span>
          </button>
          <button class="line footer-button display-shortcuts-help">
            Display keyboard shortcuts
          </button>
          <button class="line footer-button display-quick-switch">
            Go to a HexDocs package
          </button>
        </p>
      </footer>
    </div>
  </div>
</section>
</div>
  </body>
</html>
