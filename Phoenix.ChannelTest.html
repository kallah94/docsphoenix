<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.21.2">
    <meta name="project" content="Phoenix v1.4.15">
    <title>Phoenix.ChannelTest â€” Phoenix v1.4.15</title>
    <link rel="stylesheet" href="dist/html-de2388dc2f8074b0a4db.css" />
    <script src="dist/sidebar_items-c08200cd71.js"></script>
      <script src="docs_config.js"></script>
    <script async src="dist/html-de2388dc2f8074b0a4db.js"></script>
  </head>
  <body data-type="modules">
    <script>try { if(localStorage.getItem('night-mode') === 'true') document.body.className += ' night-mode'; } catch (e) { }</script>
<div class="main">

<button class="sidebar-button sidebar-toggle">
  <span class="icon-menu" title="Collapse/expand sidebar"></span>
</button>

<section class="sidebar">
  <form class="sidebar-search" action="search.html">
    <button type="submit" class="search-button">
      <span class="icon-search" aria-hidden="true"></span>
    </button>
    <button type="button" tabindex="-1" class="search-close-button">
      <span class="icon-cross" title="Cancel search"></span>
    </button>
    <label class="search-label">
      <input name="q" type="text" id="search-list" class="search-input" placeholder="Search..." aria-label="Search" autocomplete="off" />
    </label>
  </form>

  <div class="autocomplete">
    <div class="autocomplete-results">
    </div>
  </div>

  <div class="sidebar-header">
    <div class="sidebar-projectDetails">
      <a href="http://www.phoenixframework.org" class="sidebar-projectName">
Phoenix      </a>
      <h2 class="sidebar-projectVersion">
        v1.4.15
      </h2>
    </div>
      <a href="http://www.phoenixframework.org">
        <img src="assets/logo.png" alt="Phoenix" class="sidebar-projectImage">
      </a>
  </div>

  <ul class="sidebar-listNav">
    <li><a id="extras-list" href="#full-list">GUIDES</a></li>

      <li><a id="modules-list" href="#full-list">Modules</a></li>

      <li><a id="exceptions-list" href="#full-list">Exceptions</a></li>

      <li><a id="tasks-list" href="#full-list">Mix Tasks</a></li>
  </ul>
  <div class="gradient"></div>
  <ul id="full-list" class="sidebar-fullList"></ul>
</section>

<section class="content">
  <div class="content-outer">
    <div id="content" class="content-inner">

      <h1>
        <small class="app-vsn">Phoenix v1.4.15</small>
Phoenix.ChannelTest          <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.15/lib/phoenix/test/channel_test.ex#L1" title="View Source" class="view-source" rel="help">
            <span class="icon-code" aria-hidden="true"></span>
            <span class="sr-only">View Source</span>
          </a>
      </h1>


        <section id="moduledoc">
<p>Conveniences for testing Phoenix channels.</p>
<p>In channel tests, we interact with channels via process
communication, sending and receiving messages. It is also
common to subscribe to the same topic the channel subscribes
to, allowing us to assert if a given message was broadcast
or not.</p>
<h2 id="module-channel-testing" class="section-heading">
  <a href="#module-channel-testing" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Channel testing
</h2>

<p>To get started, define the module attribute <code class="inline">@endpoint</code>
in your test case pointing to your application endpoint.</p>
<p>Then you can directly create a socket and
<a href="#subscribe_and_join/4"><code class="inline">subscribe_and_join/4</code></a> topics and channels:</p>
<pre><code class="nohighlight makeup elixir"><span class="p" data-group-id="6324507790-1">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="6324507790-1">}</span><span class="w"> </span><span class="o">=</span><span class="w">
  </span><span class="n">socket</span><span class="p" data-group-id="6324507790-2">(</span><span class="nc">UserSocket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:id&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6324507790-3">%{</span><span class="ss">some_assigns</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="6324507790-3">}</span><span class="p" data-group-id="6324507790-2">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">subscribe_and_join</span><span class="p" data-group-id="6324507790-4">(</span><span class="nc">RoomChannel</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;room:lobby&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6324507790-5">%{</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="o">=</span><span class="o">&gt;</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="6324507790-5">}</span><span class="p" data-group-id="6324507790-4">)</span></code></pre>
<p>You usually want to set the same ID and assigns your
<code class="inline">UserSocket.connect/3</code> callback would set. Alternatively,
you can use the <a href="#connect/3"><code class="inline">connect/3</code></a> helper to call your <code class="inline">UserSocket.connect/3</code>
callback and initialize the socket with the socket id:</p>
<pre><code class="nohighlight makeup elixir"><span class="p" data-group-id="9133771906-1">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="9133771906-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connect</span><span class="p" data-group-id="9133771906-2">(</span><span class="nc">UserSocket</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9133771906-3">%{</span><span class="s">&quot;some&quot;</span><span class="w"> </span><span class="o">=</span><span class="o">&gt;</span><span class="w"> </span><span class="s">&quot;params&quot;</span><span class="p" data-group-id="9133771906-3">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9133771906-4">%{</span><span class="p" data-group-id="9133771906-4">}</span><span class="p" data-group-id="9133771906-2">)</span><span class="w">
</span><span class="p" data-group-id="9133771906-5">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="9133771906-5">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subscribe_and_join</span><span class="p" data-group-id="9133771906-6">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;room:lobby&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9133771906-7">%{</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="o">=</span><span class="o">&gt;</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="9133771906-7">}</span><span class="p" data-group-id="9133771906-6">)</span></code></pre>
<p>Once called, <a href="#subscribe_and_join/4"><code class="inline">subscribe_and_join/4</code></a> will subscribe the
current test process to the &quot;room:lobby&quot; topic and start a
channel in another process. It returns <code class="inline">{:ok, reply, socket}</code>
or <code class="inline">{:error, reply}</code>.</p>
<p>Now, in the same way the channel has a socket representing
communication it will push to the client. Our test has a
socket representing communication to be pushed to the server.</p>
<p>For example, we can use the <a href="#push/3"><code class="inline">push/3</code></a> function in the test
to push messages to the channel (it will invoke <code class="inline">handle_in/3</code>):</p>
<pre><code class="nohighlight makeup elixir"><span class="n">push</span><span class="p" data-group-id="3759574047-1">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;my_event&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3759574047-2">%{</span><span class="s">&quot;some&quot;</span><span class="w"> </span><span class="o">=</span><span class="o">&gt;</span><span class="w"> </span><span class="s">&quot;data&quot;</span><span class="p" data-group-id="3759574047-2">}</span><span class="p" data-group-id="3759574047-1">)</span></code></pre>
<p>Similarly, we can broadcast messages from the test itself
on the topic that both test and channel are subscribed to,
triggering <code class="inline">handle_out/3</code> on the channel:</p>
<pre><code class="nohighlight makeup elixir"><span class="n">broadcast_from</span><span class="p" data-group-id="9332079595-1">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;my_event&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9332079595-2">%{</span><span class="s">&quot;some&quot;</span><span class="w"> </span><span class="o">=</span><span class="o">&gt;</span><span class="w"> </span><span class="s">&quot;data&quot;</span><span class="p" data-group-id="9332079595-2">}</span><span class="p" data-group-id="9332079595-1">)</span></code></pre>
<blockquote><p>Note only <a href="#broadcast_from/3"><code class="inline">broadcast_from/3</code></a> and <a href="#broadcast_from!/3"><code class="inline">broadcast_from!/3</code></a> are
available in tests to avoid broadcast messages to be resent
to the test process.</p>
</blockquote>
<p>While the functions above are pushing data to the channel
(server) we can use <a href="#assert_push/3"><code class="inline">assert_push/3</code></a> to verify the channel
pushed a message to the client:</p>
<pre><code class="nohighlight makeup elixir"><span class="n">assert_push</span><span class="w"> </span><span class="s">&quot;my_event&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8731637463-1">%{</span><span class="s">&quot;some&quot;</span><span class="w"> </span><span class="o">=</span><span class="o">&gt;</span><span class="w"> </span><span class="s">&quot;data&quot;</span><span class="p" data-group-id="8731637463-1">}</span></code></pre>
<p>Or even assert something was broadcast into pubsub:</p>
<pre><code class="nohighlight makeup elixir"><span class="n">assert_broadcast</span><span class="w"> </span><span class="s">&quot;my_event&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8583129401-1">%{</span><span class="s">&quot;some&quot;</span><span class="w"> </span><span class="o">=</span><span class="o">&gt;</span><span class="w"> </span><span class="s">&quot;data&quot;</span><span class="p" data-group-id="8583129401-1">}</span></code></pre>
<p>Finally, every time a message is pushed to the channel,
a reference is returned. We can use this reference to
assert a particular reply was sent from the server:</p>
<pre><code class="nohighlight makeup elixir"><span class="n">ref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">push</span><span class="p" data-group-id="0827752524-1">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;counter&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0827752524-2">%{</span><span class="p" data-group-id="0827752524-2">}</span><span class="p" data-group-id="0827752524-1">)</span><span class="w">
</span><span class="n">assert_reply</span><span class="w"> </span><span class="n">ref</span><span class="p">,</span><span class="w"> </span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0827752524-3">%{</span><span class="s">&quot;counter&quot;</span><span class="w"> </span><span class="o">=</span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="0827752524-3">}</span></code></pre>
<h2 id="module-checking-side-effects" class="section-heading">
  <a href="#module-checking-side-effects" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Checking side-effects
</h2>

<p>Often one may want to do side-effects inside channels,
like writing to the database, and verify those side-effects
during their tests.</p>
<p>Imagine the following <code class="inline">handle_in/3</code> inside a channel:</p>
<pre><code class="nohighlight makeup elixir"><span class="kd">def</span><span class="w"> </span><span class="nf">handle_in</span><span class="p" data-group-id="9256809524-1">(</span><span class="s">&quot;publish&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9256809524-2">%{</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="o">=</span><span class="o">&gt;</span><span class="w"> </span><span class="n">id</span><span class="p" data-group-id="9256809524-2">}</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="9256809524-1">)</span><span class="w"> </span><span class="k" data-group-id="9256809524-3">do</span><span class="w">
  </span><span class="nc">Repo</span><span class="o">.</span><span class="n">get!</span><span class="p" data-group-id="9256809524-4">(</span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p" data-group-id="9256809524-4">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Post</span><span class="o">.</span><span class="n">publish</span><span class="p" data-group-id="9256809524-5">(</span><span class="p" data-group-id="9256809524-5">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Repo</span><span class="o">.</span><span class="n">update!</span><span class="p" data-group-id="9256809524-6">(</span><span class="p" data-group-id="9256809524-6">)</span><span class="w">
  </span><span class="p" data-group-id="9256809524-7">{</span><span class="ss">:noreply</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="9256809524-7">}</span><span class="w">
</span><span class="k" data-group-id="9256809524-3">end</span></code></pre>
<p>Because the whole communication is asynchronous, the
following test would be very brittle:</p>
<pre><code class="nohighlight makeup elixir"><span class="n">push</span><span class="p" data-group-id="6037844397-1">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;publish&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6037844397-2">%{</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="o">=</span><span class="o">&gt;</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="6037844397-2">}</span><span class="p" data-group-id="6037844397-1">)</span><span class="w">
</span><span class="n">assert</span><span class="w"> </span><span class="nc">Repo</span><span class="o">.</span><span class="n">get_by</span><span class="p" data-group-id="6037844397-3">(</span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="ss">published</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="6037844397-3">)</span></code></pre>
<p>The issue is that we have no guarantees the channel has
done processing our message after calling <a href="#push/3"><code class="inline">push/3</code></a>. The
best solution is to assert the channel sent us a reply
before doing any other assertion. First change the
channel to send replies:</p>
<pre><code class="nohighlight makeup elixir"><span class="kd">def</span><span class="w"> </span><span class="nf">handle_in</span><span class="p" data-group-id="9225983656-1">(</span><span class="s">&quot;publish&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9225983656-2">%{</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="o">=</span><span class="o">&gt;</span><span class="w"> </span><span class="n">id</span><span class="p" data-group-id="9225983656-2">}</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="9225983656-1">)</span><span class="w"> </span><span class="k" data-group-id="9225983656-3">do</span><span class="w">
  </span><span class="nc">Repo</span><span class="o">.</span><span class="n">get!</span><span class="p" data-group-id="9225983656-4">(</span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p" data-group-id="9225983656-4">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Post</span><span class="o">.</span><span class="n">publish</span><span class="p" data-group-id="9225983656-5">(</span><span class="p" data-group-id="9225983656-5">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Repo</span><span class="o">.</span><span class="n">update!</span><span class="p" data-group-id="9225983656-6">(</span><span class="p" data-group-id="9225983656-6">)</span><span class="w">
  </span><span class="p" data-group-id="9225983656-7">{</span><span class="ss">:reply</span><span class="p">,</span><span class="w"> </span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="9225983656-7">}</span><span class="w">
</span><span class="k" data-group-id="9225983656-3">end</span></code></pre>
<p>Then expect them in the test:</p>
<pre><code class="nohighlight makeup elixir"><span class="n">ref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">push</span><span class="p" data-group-id="4386910206-1">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;publish&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4386910206-2">%{</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="o">=</span><span class="o">&gt;</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="4386910206-2">}</span><span class="p" data-group-id="4386910206-1">)</span><span class="w">
</span><span class="n">assert_reply</span><span class="w"> </span><span class="n">ref</span><span class="p">,</span><span class="w"> </span><span class="ss">:ok</span><span class="w">
</span><span class="n">assert</span><span class="w"> </span><span class="nc">Repo</span><span class="o">.</span><span class="n">get_by</span><span class="p" data-group-id="4386910206-3">(</span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="ss">published</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="4386910206-3">)</span></code></pre>
<h2 id="module-leave-and-close" class="section-heading">
  <a href="#module-leave-and-close" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Leave and close
</h2>

<p>This module also provides functions to simulate leaving
and closing a channel. Once you leave or close a channel,
because the channel is linked to the test process on join,
it will crash the test process:</p>
<pre><code class="nohighlight makeup elixir"><span class="n">leave</span><span class="p" data-group-id="3695161038-1">(</span><span class="n">socket</span><span class="p" data-group-id="3695161038-1">)</span><span class="w">
</span><span class="gt">** (EXIT from #PID&lt;...&gt;) {:shutdown, :leave}</span></code></pre>
<p>You can avoid this by unlinking the channel process in
the test:</p>
<pre><code class="nohighlight makeup elixir"><span class="nc">Process</span><span class="o">.</span><span class="n">unlink</span><span class="p" data-group-id="5943603674-1">(</span><span class="n">socket</span><span class="o">.</span><span class="n">channel_pid</span><span class="p" data-group-id="5943603674-1">)</span></code></pre>
<p>Notice <a href="#leave/1"><code class="inline">leave/1</code></a> is async, so it will also return a
reference which you can use to check for a reply:</p>
<pre><code class="nohighlight makeup elixir"><span class="n">ref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">leave</span><span class="p" data-group-id="9431857848-1">(</span><span class="n">socket</span><span class="p" data-group-id="9431857848-1">)</span><span class="w">
</span><span class="n">assert_reply</span><span class="w"> </span><span class="n">ref</span><span class="p">,</span><span class="w"> </span><span class="ss">:ok</span></code></pre>
<p>On the other hand, close is always sync and it will
return only after the channel process is guaranteed to
have been terminated:</p>
<pre><code class="nohighlight makeup elixir"><span class="ss">:ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">close</span><span class="p" data-group-id="4723432451-1">(</span><span class="n">socket</span><span class="p" data-group-id="4723432451-1">)</span></code></pre>
<p>This mimics the behaviour existing in clients.</p>
<p>To assert that your channel closes or errors asynchronously,
you can monitor the channel process with the tools provided
by Elixir, and wait for the <code class="inline">:DOWN</code> message.
Imagine an implementation of the <code class="inline">handle_info/2</code> function
that closes the channel when it receives <code class="inline">:some_message</code>:</p>
<pre><code class="nohighlight makeup elixir"><span class="kd">def</span><span class="w"> </span><span class="nf">handle_info</span><span class="p" data-group-id="1237774335-1">(</span><span class="ss">:some_message</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="1237774335-1">)</span><span class="w"> </span><span class="k" data-group-id="1237774335-2">do</span><span class="w">
  </span><span class="p" data-group-id="1237774335-3">{</span><span class="ss">:stop</span><span class="p">,</span><span class="w"> </span><span class="ss">:normal</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="p" data-group-id="1237774335-3">}</span><span class="w">
</span><span class="k" data-group-id="1237774335-2">end</span></code></pre>
<p>In your test, you can assert that the close happened by:</p>
<pre><code class="nohighlight makeup elixir"><span class="nc">Process</span><span class="o">.</span><span class="n">monitor</span><span class="p" data-group-id="5748432441-1">(</span><span class="n">socket</span><span class="o">.</span><span class="n">channel_pid</span><span class="p" data-group-id="5748432441-1">)</span><span class="w">
</span><span class="n">send</span><span class="p" data-group-id="5748432441-2">(</span><span class="n">socket</span><span class="o">.</span><span class="n">channel_pid</span><span class="p">,</span><span class="w"> </span><span class="ss">:some_message</span><span class="p" data-group-id="5748432441-2">)</span><span class="w">
</span><span class="n">assert_receive</span><span class="w"> </span><span class="p" data-group-id="5748432441-3">{</span><span class="ss">:DOWN</span><span class="p">,</span><span class="w"> </span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="ss">:normal</span><span class="p" data-group-id="5748432441-3">}</span></code></pre>
        </section>

        <section id="summary" class="details-list">
          <h1 class="section-heading">
            <a class="hover-link" href="#summary">
              <span class="icon-link" aria-hidden="true"></span>
              <span class="sr-only">Link to this section</span>
            </a>
            Summary
          </h1>
  <div class="summary-functions summary">
    <h2>
      <a href="#functions">Functions</a>
    </h2>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#assert_broadcast/3">assert_broadcast(event, payload, timeout \\ Application.fetch_env!(:ex_unit, :assert_receive_timeout))</a>
  </div>
    <div class="summary-synopsis"><p>Asserts the channel has broadcast a message within <code class="inline">timeout</code>.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#assert_push/3">assert_push(event, payload, timeout \\ Application.fetch_env!(:ex_unit, :assert_receive_timeout))</a>
  </div>
    <div class="summary-synopsis"><p>Asserts the channel has pushed a message back to the client
with the given event and payload within <code class="inline">timeout</code>.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#assert_reply/4">assert_reply(ref, status, payload \\ Macro.escape(%{}), timeout \\ Application.fetch_env!(:ex_unit, :assert_receive_timeout))</a>
  </div>
    <div class="summary-synopsis"><p>Asserts the channel has replied to the given message within
<code class="inline">timeout</code>.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#broadcast_from/3">broadcast_from(socket, event, message)</a>
  </div>
    <div class="summary-synopsis"><p>Broadcast event from pid to all subscribers of the socket topic.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#broadcast_from!/3">broadcast_from!(socket, event, message)</a>
  </div>
    <div class="summary-synopsis"><p>Same as <a href="#broadcast_from/3"><code class="inline">broadcast_from/3</code></a>, but raises if broadcast fails.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#close/2">close(socket, timeout \\ 5000)</a>
  </div>
    <div class="summary-synopsis"><p>Emulates the client closing the socket.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#connect/3">connect(handler, params, connect_info \\ quote do
  %{}
end)</a>
  </div>
    <div class="summary-synopsis"><p>Initiates a transport connection for the socket handler.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#join/2">join(socket, topic)</a>
  </div>
    <div class="summary-synopsis"><p>See <a href="#join/4"><code class="inline">join/4</code></a>.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#join/3">join(socket, topic, payload)</a>
  </div>
    <div class="summary-synopsis"><p>See <a href="#join/4"><code class="inline">join/4</code></a>.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#join/4">join(socket, channel, topic, payload \\ %{})</a>
  </div>
    <div class="summary-synopsis"><p>Joins the channel under the given topic and payload.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#leave/1">leave(socket)</a>
  </div>
    <div class="summary-synopsis"><p>Emulates the client leaving the channel.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#push/3">push(socket, event, payload \\ %{})</a>
  </div>
    <div class="summary-synopsis"><p>Pushes a message into the channel.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#refute_broadcast/3">refute_broadcast(event, payload, timeout \\ Application.fetch_env!(:ex_unit, :refute_receive_timeout))</a>
  </div>
    <div class="summary-synopsis"><p>Asserts the channel has not broadcast a message within <code class="inline">timeout</code>.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#refute_push/3">refute_push(event, payload, timeout \\ Application.fetch_env!(:ex_unit, :refute_receive_timeout))</a>
  </div>
    <div class="summary-synopsis"><p>Asserts the channel has not pushed a message to the client
matching the given event and payload within <code class="inline">timeout</code>.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#refute_reply/4">refute_reply(ref, status, payload \\ Macro.escape(%{}), timeout \\ Application.fetch_env!(:ex_unit, :refute_receive_timeout))</a>
  </div>
    <div class="summary-synopsis"><p>Asserts the channel has not replied with a matching payload within
<code class="inline">timeout</code>.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#socket/1">socket(socket_module)</a>
  </div>
    <div class="summary-synopsis"><p>Builds a socket for the given <code class="inline">socket_module</code>.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#socket/3">socket(socket_module, socket_id, socket_assigns)</a>
  </div>
    <div class="summary-synopsis"><p>Builds a socket for the given <code class="inline">socket_module</code> with given id and assigns.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#subscribe_and_join/2">subscribe_and_join(socket, topic)</a>
  </div>
    <div class="summary-synopsis"><p>See <a href="#subscribe_and_join/4"><code class="inline">subscribe_and_join/4</code></a>.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#subscribe_and_join/3">subscribe_and_join(socket, topic, payload)</a>
  </div>
    <div class="summary-synopsis"><p>See <a href="#subscribe_and_join/4"><code class="inline">subscribe_and_join/4</code></a>.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#subscribe_and_join/4">subscribe_and_join(socket, channel, topic, payload \\ %{})</a>
  </div>
    <div class="summary-synopsis"><p>Subscribes to the given topic and joins the channel
under the given topic and payload.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#subscribe_and_join!/2">subscribe_and_join!(socket, topic)</a>
  </div>
    <div class="summary-synopsis"><p>See <a href="#subscribe_and_join!/4"><code class="inline">subscribe_and_join!/4</code></a>.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#subscribe_and_join!/3">subscribe_and_join!(socket, topic, payload)</a>
  </div>
    <div class="summary-synopsis"><p>See <a href="#subscribe_and_join!/4"><code class="inline">subscribe_and_join!/4</code></a>.</p></div>
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#subscribe_and_join!/4">subscribe_and_join!(socket, channel, topic, payload \\ %{})</a>
  </div>
    <div class="summary-synopsis"><p>Same as <a href="#subscribe_and_join/4"><code class="inline">subscribe_and_join/4</code></a>, but returns either the socket
or throws an error.</p></div>
</div>
  </div>
        </section>

        <section id="functions" class="details-list">
          <h1 class="section-heading">
            <a class="hover-link" href="#functions">
              <span class="icon-link" aria-hidden="true"></span>
              <span class="sr-only">Link to this section</span>
            </a>
Functions          </h1>
          <div class="functions-list">
<section class="detail" id="assert_broadcast/3">
    <span id="assert_broadcast/2"></span>
  <div class="detail-header">
    <a href="#assert_broadcast/3" class="detail-link" title="Link to this macro">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this macro</span>
    </a>
    <h1 class="signature">assert_broadcast(event, payload, timeout \\ Application.fetch_env!(:ex_unit, :assert_receive_timeout))</h1>
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.15/lib/phoenix/test/channel_test.ex#L572" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
      <span class="note">(macro)</span>
  </div>
  <section class="docstring">
<p>Asserts the channel has broadcast a message within <code class="inline">timeout</code>.</p>
<p>Before asserting anything was broadcast, we must first
subscribe to the topic of the channel in the test process:</p>
<pre><code class="nohighlight makeup elixir"><span class="na">@endpoint</span><span class="o">.</span><span class="n">subscribe</span><span class="p" data-group-id="7831320366-1">(</span><span class="s">&quot;foo:ok&quot;</span><span class="p" data-group-id="7831320366-1">)</span></code></pre>
<p>Now we can match on event and payload as patterns:</p>
<pre><code class="nohighlight makeup elixir"><span class="n">assert_broadcast</span><span class="w"> </span><span class="s">&quot;some_event&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5393663633-1">%{</span><span class="s">&quot;data&quot;</span><span class="w"> </span><span class="o">=</span><span class="o">&gt;</span><span class="w"> </span><span class="bp">_</span><span class="p" data-group-id="5393663633-1">}</span></code></pre>
<p>In the assertion above, we don&#39;t particularly care about
the data being sent, as long as something was sent.</p>
<p>The timeout is in milliseconds and defaults to the <code class="inline">:assert_receive_timeout</code>
set on the <code class="inline">:ex_unit</code> application (which defaults to 100ms).</p>
  </section>
</section>
<section class="detail" id="assert_push/3">
    <span id="assert_push/2"></span>
  <div class="detail-header">
    <a href="#assert_push/3" class="detail-link" title="Link to this macro">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this macro</span>
    </a>
    <h1 class="signature">assert_push(event, payload, timeout \\ Application.fetch_env!(:ex_unit, :assert_receive_timeout))</h1>
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.15/lib/phoenix/test/channel_test.ex#L479" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
      <span class="note">(macro)</span>
  </div>
  <section class="docstring">
<p>Asserts the channel has pushed a message back to the client
with the given event and payload within <code class="inline">timeout</code>.</p>
<p>Notice event and payload are patterns. This means one can write:</p>
<pre><code class="nohighlight makeup elixir"><span class="n">assert_push</span><span class="w"> </span><span class="s">&quot;some_event&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2752551027-1">%{</span><span class="s">&quot;data&quot;</span><span class="w"> </span><span class="o">=</span><span class="o">&gt;</span><span class="w"> </span><span class="bp">_</span><span class="p" data-group-id="2752551027-1">}</span></code></pre>
<p>In the assertion above, we don&#39;t particularly care about
the data being sent, as long as something was sent.</p>
<p>The timeout is in milliseconds and defaults to the <code class="inline">:assert_receive_timeout</code>
set on the <code class="inline">:ex_unit</code> application (which defaults to 100ms).</p>
<p><strong>NOTE:</strong> Because event and payload are patterns, they will be matched.  This
means that if you wish to assert that the received payload is equivalent to
an existing variable, you need to pin the variable in the assertion
expression.</p>
<p>Good:</p>
<pre><code class="nohighlight makeup elixir"><span class="n">expected_payload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="3708189031-1">%{</span><span class="ss">foo</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bar&quot;</span><span class="p" data-group-id="3708189031-1">}</span><span class="w">
</span><span class="n">assert_push</span><span class="w"> </span><span class="s">&quot;some_event&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">^</span><span class="n">expected_payload</span></code></pre>
<p>Bad:</p>
<pre><code class="nohighlight makeup elixir"><span class="n">expected_payload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5145335550-1">%{</span><span class="ss">foo</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bar&quot;</span><span class="p" data-group-id="5145335550-1">}</span><span class="w">
</span><span class="n">assert_push</span><span class="w"> </span><span class="s">&quot;some_event&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">expected_payload</span><span class="w">
</span><span class="c1"># The code above does not assert the payload matches the described map.</span></code></pre>
  </section>
</section>
<section class="detail" id="assert_reply/4">
    <span id="assert_reply/2"></span>
    <span id="assert_reply/3"></span>
  <div class="detail-header">
    <a href="#assert_reply/4" class="detail-link" title="Link to this macro">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this macro</span>
    </a>
    <h1 class="signature">assert_reply(ref, status, payload \\ Macro.escape(%{}), timeout \\ Application.fetch_env!(:ex_unit, :assert_receive_timeout))</h1>
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.15/lib/phoenix/test/channel_test.ex#L522" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
      <span class="note">(macro)</span>
  </div>
  <section class="docstring">
<p>Asserts the channel has replied to the given message within
<code class="inline">timeout</code>.</p>
<p>Notice status and payload are patterns. This means one can write:</p>
<pre><code class="nohighlight makeup elixir"><span class="n">ref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">push</span><span class="p" data-group-id="0525628364-1">(</span><span class="n">channel</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;some_event&quot;</span><span class="p" data-group-id="0525628364-1">)</span><span class="w">
</span><span class="n">assert_reply</span><span class="w"> </span><span class="n">ref</span><span class="p">,</span><span class="w"> </span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0525628364-2">%{</span><span class="s">&quot;data&quot;</span><span class="w"> </span><span class="o">=</span><span class="o">&gt;</span><span class="w"> </span><span class="bp">_</span><span class="p" data-group-id="0525628364-2">}</span></code></pre>
<p>In the assertion above, we don&#39;t particularly care about
the data being sent, as long as something was replied.</p>
<p>The timeout is in milliseconds and defaults to the <code class="inline">:assert_receive_timeout</code>
set on the <code class="inline">:ex_unit</code> application (which defaults to 100ms).</p>
  </section>
</section>
<section class="detail" id="broadcast_from/3">
  <div class="detail-header">
    <a href="#broadcast_from/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">broadcast_from(socket, event, message)</h1>
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.15/lib/phoenix/test/channel_test.ex#L435" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
  </div>
  <section class="docstring">
<p>Broadcast event from pid to all subscribers of the socket topic.</p>
<p>The test process will not receive the published message. This triggers
the <code class="inline">handle_out/3</code> callback in the channel.</p>
<h2 id="broadcast_from/3-examples" class="section-heading">
  <a href="#broadcast_from/3-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup elixir"><span class="gp unselectable">iex&gt; </span><span class="n">broadcast_from</span><span class="p" data-group-id="7635258984-1">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;new_message&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7635258984-2">%{</span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">content</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;hello&quot;</span><span class="p" data-group-id="7635258984-2">}</span><span class="p" data-group-id="7635258984-1">)</span><span class="w">
</span><span class="ss">:ok</span></code></pre>
  </section>
</section>
<section class="detail" id="broadcast_from!/3">
  <div class="detail-header">
    <a href="#broadcast_from!/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">broadcast_from!(socket, event, message)</h1>
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.15/lib/phoenix/test/channel_test.ex#L443" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
  </div>
  <section class="docstring">
<p>Same as <a href="#broadcast_from/3"><code class="inline">broadcast_from/3</code></a>, but raises if broadcast fails.</p>
  </section>
</section>
<section class="detail" id="close/2">
    <span id="close/1"></span>
  <div class="detail-header">
    <a href="#close/2" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">close(socket, timeout \\ 5000)</h1>
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.15/lib/phoenix/test/channel_test.ex#L419" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
  </div>
  <section class="docstring">
<p>Emulates the client closing the socket.</p>
<p>Closing socket is synchronous and has a default timeout
of 5000 milliseconds.</p>
  </section>
</section>
<section class="detail" id="connect/3">
    <span id="connect/2"></span>
  <div class="detail-header">
    <a href="#connect/3" class="detail-link" title="Link to this macro">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this macro</span>
    </a>
    <h1 class="signature">connect(handler, params, connect_info \\ quote do
  %{}
end)</h1>
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.15/lib/phoenix/test/channel_test.ex#L259" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
      <span class="note">(macro)</span>
  </div>
  <section class="docstring">
<p>Initiates a transport connection for the socket handler.</p>
<p>Useful for testing UserSocket authentication. Returns
the result of the handler&#39;s <a href="#connect/3"><code class="inline">connect/3</code></a> callback.</p>
  </section>
</section>
<section class="detail" id="join/2">
  <div class="detail-header">
    <a href="#join/2" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">join(socket, topic)</h1>
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.15/lib/phoenix/test/channel_test.ex#L344" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
  </div>
  <section class="docstring">
<p>See <a href="#join/4"><code class="inline">join/4</code></a>.</p>
  </section>
</section>
<section class="detail" id="join/3">
  <div class="detail-header">
    <a href="#join/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">join(socket, topic, payload)</h1>
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.15/lib/phoenix/test/channel_test.ex#L349" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
  </div>
  <section class="docstring">
<p>See <a href="#join/4"><code class="inline">join/4</code></a>.</p>
  </section>
</section>
<section class="detail" id="join/4">
    <span id="join/3"></span>
  <div class="detail-header">
    <a href="#join/4" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">join(socket, channel, topic, payload \\ %{})</h1>
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.15/lib/phoenix/test/channel_test.ex#L361" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
  </div>
  <section class="docstring">
<p>Joins the channel under the given topic and payload.</p>
<p>The given channel is joined in a separate process
which is linked to the test process.</p>
<p>It returns <code class="inline">{:ok, reply, socket}</code> or <code class="inline">{:error, reply}</code>.</p>
  </section>
</section>
<section class="detail" id="leave/1">
  <div class="detail-header">
    <a href="#leave/1" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">leave(socket)</h1>
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.15/lib/phoenix/test/channel_test.ex#L409" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
      <div class="specs">
          <pre>leave(<a href="Phoenix.Socket.html#t:t/0">Phoenix.Socket.t</a>()) :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">reference</a>()</pre>
      </div>
  </div>
  <section class="docstring">
<p>Emulates the client leaving the channel.</p>
  </section>
</section>
<section class="detail" id="push/3">
    <span id="push/2"></span>
  <div class="detail-header">
    <a href="#push/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">push(socket, event, payload \\ %{})</h1>
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.15/lib/phoenix/test/channel_test.ex#L398" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
      <div class="specs">
          <pre>push(<a href="Phoenix.Socket.html#t:t/0">Phoenix.Socket.t</a>(), <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>()) :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">reference</a>()</pre>
      </div>
  </div>
  <section class="docstring">
<p>Pushes a message into the channel.</p>
<p>The triggers the <code class="inline">handle_in/3</code> callback in the channel.</p>
<h2 id="push/3-examples" class="section-heading">
  <a href="#push/3-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup elixir"><span class="gp unselectable">iex&gt; </span><span class="n">push</span><span class="p" data-group-id="7760204643-1">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;new_message&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7760204643-2">%{</span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">content</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;hello&quot;</span><span class="p" data-group-id="7760204643-2">}</span><span class="p" data-group-id="7760204643-1">)</span><span class="w">
</span><span class="n">reference</span></code></pre>
  </section>
</section>
<section class="detail" id="refute_broadcast/3">
    <span id="refute_broadcast/2"></span>
  <div class="detail-header">
    <a href="#refute_broadcast/3" class="detail-link" title="Link to this macro">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this macro</span>
    </a>
    <h1 class="signature">refute_broadcast(event, payload, timeout \\ Application.fetch_env!(:ex_unit, :refute_receive_timeout))</h1>
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.15/lib/phoenix/test/channel_test.ex#L590" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
      <span class="note">(macro)</span>
  </div>
  <section class="docstring">
<p>Asserts the channel has not broadcast a message within <code class="inline">timeout</code>.</p>
<p>Like <code class="inline">assert_broadcast</code>, the event and payload are patterns.</p>
<p>The timeout is in milliseconds and defaults to the <code class="inline">:refute_receive_timeout</code>
set on the <code class="inline">:ex_unit</code> application (which defaults to 100ms).
Keep in mind this macro will block the test by the
timeout value, so use it only when necessary as overuse
will certainly slow down your test suite.</p>
  </section>
</section>
<section class="detail" id="refute_push/3">
    <span id="refute_push/2"></span>
  <div class="detail-header">
    <a href="#refute_push/3" class="detail-link" title="Link to this macro">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this macro</span>
    </a>
    <h1 class="signature">refute_push(event, payload, timeout \\ Application.fetch_env!(:ex_unit, :refute_receive_timeout))</h1>
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.15/lib/phoenix/test/channel_test.ex#L499" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
      <span class="note">(macro)</span>
  </div>
  <section class="docstring">
<p>Asserts the channel has not pushed a message to the client
matching the given event and payload within <code class="inline">timeout</code>.</p>
<p>Like <code class="inline">assert_push</code>, the event and payload are patterns.</p>
<p>The timeout is in milliseconds and defaults to the <code class="inline">:refute_receive_timeout</code>
set on the <code class="inline">:ex_unit</code> application (which defaults to 100ms).
Keep in mind this macro will block the test by the
timeout value, so use it only when necessary as overuse
will certainly slow down your test suite.</p>
  </section>
</section>
<section class="detail" id="refute_reply/4">
    <span id="refute_reply/2"></span>
    <span id="refute_reply/3"></span>
  <div class="detail-header">
    <a href="#refute_reply/4" class="detail-link" title="Link to this macro">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this macro</span>
    </a>
    <h1 class="signature">refute_reply(ref, status, payload \\ Macro.escape(%{}), timeout \\ Application.fetch_env!(:ex_unit, :refute_receive_timeout))</h1>
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.15/lib/phoenix/test/channel_test.ex#L544" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
      <span class="note">(macro)</span>
  </div>
  <section class="docstring">
<p>Asserts the channel has not replied with a matching payload within
<code class="inline">timeout</code>.</p>
<p>Like <code class="inline">assert_reply</code>, the event and payload are patterns.</p>
<p>The timeout is in milliseconds and defaults to the <code class="inline">:refute_receive_timeout</code>
set on the <code class="inline">:ex_unit</code> application (which defaults to 100ms).
Keep in mind this macro will block the test by the
timeout value, so use it only when necessary as overuse
will certainly slow down your test suite.</p>
  </section>
</section>
<section class="detail" id="socket/1">
  <div class="detail-header">
    <a href="#socket/1" class="detail-link" title="Link to this macro">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this macro</span>
    </a>
    <h1 class="signature">socket(socket_module)</h1>
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.15/lib/phoenix/test/channel_test.ex#L198" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
      <span class="note">(macro)</span>
  </div>
  <section class="docstring">
<p>Builds a socket for the given <code class="inline">socket_module</code>.</p>
<p>The socket is then used to subscribe and join channels.
Use this function when you want to create a blank socket
to pass to functions like <code class="inline">UserSocket.connect/3</code>.</p>
<p>Otherwise, use <a href="#socket/3"><code class="inline">socket/3</code></a> if you want to build a socket with
existing id and assigns.</p>
<h2 id="socket/1-examples" class="section-heading">
  <a href="#socket/1-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup elixir"><span class="n">socket</span><span class="p" data-group-id="8446125046-1">(</span><span class="nc">MyApp.UserSocket</span><span class="p" data-group-id="8446125046-1">)</span></code></pre>
  </section>
</section>
<section class="detail" id="socket/3">
  <div class="detail-header">
    <a href="#socket/3" class="detail-link" title="Link to this macro">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this macro</span>
    </a>
    <h1 class="signature">socket(socket_module, socket_id, socket_assigns)</h1>
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.15/lib/phoenix/test/channel_test.ex#L210" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
      <span class="note">(macro)</span>
  </div>
  <section class="docstring">
<p>Builds a socket for the given <code class="inline">socket_module</code> with given id and assigns.</p>
<h2 id="socket/3-examples" class="section-heading">
  <a href="#socket/3-examples" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Examples
</h2>

<pre><code class="nohighlight makeup elixir"><span class="n">socket</span><span class="p" data-group-id="7579768795-1">(</span><span class="nc">MyApp.UserSocket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7579768795-2">%{</span><span class="ss">some</span><span class="p">:</span><span class="w"> </span><span class="ss">:assign</span><span class="p" data-group-id="7579768795-2">}</span><span class="p" data-group-id="7579768795-1">)</span></code></pre>
  </section>
</section>
<section class="detail" id="subscribe_and_join/2">
  <div class="detail-header">
    <a href="#subscribe_and_join/2" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">subscribe_and_join(socket, topic)</h1>
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.15/lib/phoenix/test/channel_test.ex#L311" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
  </div>
  <section class="docstring">
<p>See <a href="#subscribe_and_join/4"><code class="inline">subscribe_and_join/4</code></a>.</p>
  </section>
</section>
<section class="detail" id="subscribe_and_join/3">
  <div class="detail-header">
    <a href="#subscribe_and_join/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">subscribe_and_join(socket, topic, payload)</h1>
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.15/lib/phoenix/test/channel_test.ex#L316" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
  </div>
  <section class="docstring">
<p>See <a href="#subscribe_and_join/4"><code class="inline">subscribe_and_join/4</code></a>.</p>
  </section>
</section>
<section class="detail" id="subscribe_and_join/4">
    <span id="subscribe_and_join/3"></span>
  <div class="detail-header">
    <a href="#subscribe_and_join/4" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">subscribe_and_join(socket, channel, topic, payload \\ %{})</h1>
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.15/lib/phoenix/test/channel_test.ex#L337" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
  </div>
  <section class="docstring">
<p>Subscribes to the given topic and joins the channel
under the given topic and payload.</p>
<p>By subscribing to the topic, we can use <a href="#assert_broadcast/3"><code class="inline">assert_broadcast/3</code></a>
to verify a message has been sent through the pubsub layer.</p>
<p>By joining the channel, we can interact with it directly.
The given channel is joined in a separate process which is
linked to the test process.</p>
<p>If no channel module is provided, the socket&#39;s handler is used to
lookup the matching channel for the given topic.</p>
<p>It returns <code class="inline">{:ok, reply, socket}</code> or <code class="inline">{:error, reply}</code>.</p>
  </section>
</section>
<section class="detail" id="subscribe_and_join!/2">
  <div class="detail-header">
    <a href="#subscribe_and_join!/2" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">subscribe_and_join!(socket, topic)</h1>
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.15/lib/phoenix/test/channel_test.ex#L285" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
  </div>
  <section class="docstring">
<p>See <a href="#subscribe_and_join!/4"><code class="inline">subscribe_and_join!/4</code></a>.</p>
  </section>
</section>
<section class="detail" id="subscribe_and_join!/3">
  <div class="detail-header">
    <a href="#subscribe_and_join!/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">subscribe_and_join!(socket, topic, payload)</h1>
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.15/lib/phoenix/test/channel_test.ex#L290" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
  </div>
  <section class="docstring">
<p>See <a href="#subscribe_and_join!/4"><code class="inline">subscribe_and_join!/4</code></a>.</p>
  </section>
</section>
<section class="detail" id="subscribe_and_join!/4">
    <span id="subscribe_and_join!/3"></span>
  <div class="detail-header">
    <a href="#subscribe_and_join!/4" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">subscribe_and_join!(socket, channel, topic, payload \\ %{})</h1>
      <a href="https://github.com/phoenixframework/phoenix/blob/v1.4.15/lib/phoenix/test/channel_test.ex#L302" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>
  </div>
  <section class="docstring">
<p>Same as <a href="#subscribe_and_join/4"><code class="inline">subscribe_and_join/4</code></a>, but returns either the socket
or throws an error.</p>
<p>This is helpful when you are not testing joining the channel
and just need the socket.</p>
  </section>
</section>
          </div>
        </section>
      <footer class="footer">
        <p>
          <span class="line">
            Built using
            <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener">ExDoc</a> (v0.21.2),
          </span>
          <span class="line">
            designed by
            <a href="https://twitter.com/dignifiedquire" target="_blank" rel="noopener" title="@dignifiedquire">Friedel Ziegelmayer</a>.
          </span>
        </p>
        <p>
          <button class="line footer-button night-mode-toggle">
            Toggle night mode
          </button>
          <button class="line footer-button tooltips-toggle">
            <span class="tooltips-option-disable">Disable tooltips</span>
            <span class="tooltips-option-enable">Enable tooltips</span>
          </button>
          <button class="line footer-button display-shortcuts-help">
            Display keyboard shortcuts
          </button>
          <button class="line footer-button display-quick-switch">
            Go to a HexDocs package
          </button>
        </p>
      </footer>
    </div>
  </div>
</section>
</div>
  </body>
</html>
